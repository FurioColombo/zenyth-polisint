{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.array.splice.js\";\nimport \"core-js/modules/es.array.index-of.js\";\nimport * as Tone from \"tone\";\nimport SineIcon from \"vue-material-design-icons/SineWave\";\nimport SquareIcon from \"vue-material-design-icons/SquareWave\";\nimport TriangleIcon from \"vue-material-design-icons/TriangleWave\";\nimport SawtoothIcon from \"vue-material-design-icons/SawtoothWave\";\nimport { gainToDb } from \"tone\";\nimport MyPolySynth from \"./MyPolySynth.js\";\nvar wave_types = [\"sine\", \"triangle\", \"sawtooth\", \"square\"];\nvar osc_types = [\"\", \"fm\", \"am\", \"fat\"];\nexport default {\n  components: {\n    SineIcon: SineIcon,\n    SquareIcon: SquareIcon,\n    TriangleIcon: TriangleIcon,\n    SawtoothIcon: SawtoothIcon\n  },\n  data: function data() {\n    return {\n      // todo: UPDATE ALL COLOR DEPENDING ON THIS:\n      color: {\n        vol: this.colors.pink,\n        mod: this.colors.azure,\n        pitch: this.colors.green\n      },\n      // waveform_btn_style: osc_background_colors[0], todo: colors?\n      osc_types: [\"std\", \"fm\", \"am\", \"fat\"],\n      volume: 0.5,\n      modulation: 1,\n      pitch: 0,\n      pan: 0,\n      attack: 0.01,\n      decay: 0.1,\n      sustain: 1,\n      release: 0.2,\n      maxPitch: 24,\n      minPitch: -24,\n      partials: \"\",\n      oscWaveIndex: 0,\n      // wave currently selected from  ['sine','triangle', ...]\n      oscTypeIndex: 0,\n      // type of osc selected from ['std', 'fm', ...];\n      waveform_btn_style: \"lightblue\",\n      wave_icon_size: 32,\n      is_modulationDown: false,\n      is_volumeDown: false,\n      is_pitchDown: false,\n      isFilterChainRouteActive: [true, false, false],\n      modulators: {\n        vol: null,\n        mod: null,\n        pitch: null\n      }\n    };\n  },\n  props: [\"id\"],\n  mounted: function mounted() {\n    document.addEventListener(\"mousemove\", this.onMouseMove);\n    document.addEventListener(\"mouseup\", this.onMouseUp);\n    window.addEventListener(\"resize\", this.resizeGraphics);\n\n    // resize graphics\n    this.resizeGraphics();\n    this.gainNode = new Tone.Gain();\n    //console.log(this.polyphonyVoices)\n    this.synth = new MyPolySynth(this.gainNode, this.polyphonyVoices);\n    this.synth.setParameters({\n      volume: gainToDb(1 - this.volume)\n    });\n    this.synths.list.push(this.synth);\n    //console.log(this.synths.list)\n    // we need to init connection to first filter chain\n    // in the first osc case we need to make sure we connect after the chain is created , so we handle that with events\n    // emitted from the filter chain - in all other cases we can just normally connect to the chain\n    if (this.id > 1) {\n      this.initConnections();\n    }\n    //communicate to parent that a new osc has been created (to update volEnvelope from ModHost)\n    this.$emit(\"newOsc\");\n  },\n  computed: {\n    osc_container: function osc_container() {\n      return {\n        background: '#f8e7e6'\n      };\n    },\n    /*------------ TYPE BUTTON ------------*/type_button: function type_button() {\n      return {\n        fontSize: '.5vw',\n        background: this.colors.pink.glow\n      };\n    },\n    type_text: function type_text() {\n      return {\n        color: this.colors.gray.dark\n      };\n    },\n    /*--------------- OSC -----------------*/volume_area: function volume_area() {\n      return {\n        background: this.colors.pink.dark\n      };\n    },\n    mod_area: function mod_area() {\n      return {\n        background: this.colors.azure.medium\n      };\n    },\n    pitch_area: function pitch_area() {\n      return {\n        background: this.colors.green.glow\n      };\n    },\n    mod_slider: function mod_slider() {\n      return {\n        transform: \"rotate(-\" + this.modulation * 111 + \"deg)\",\n        background: 'white',\n        opacity: '60%'\n      };\n    },\n    volume_slider: function volume_slider() {\n      return {\n        backgroundColor: 'white',\n        opacity: '60%',\n        transform: \"rotate(\" + this.volume * 112 + \"deg)\"\n      };\n    },\n    pitch_slider: function pitch_slider() {\n      return {\n        background: this.colors.green.medium\n      };\n    },\n    pitch_hand: function pitch_hand() {\n      return {\n        transform: \"rotate(\" + this.pitch * 50 / this.maxPitch + \"deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      };\n    },\n    osc_wave: function osc_wave() {\n      return {\n        border: '.1vw solid ' + this.colors.green.dark,\n        background: this.colors.green.glow\n      };\n    },\n    lineL: function lineL() {\n      return {\n        transform: \"rotate(66deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      };\n    },\n    lineU: function lineU() {\n      return {\n        transform: \"rotate(-66deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      };\n    },\n    lineR: function lineR() {\n      return {\n        transform: \"rotate(180deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      };\n    },\n    /*------------ CHAIN BUTTONS ------------*/chain_buttons: function chain_buttons() {\n      return {\n        background: this.colors.pink.glow\n      };\n    },\n    button_1: function button_1() {\n      var color = '';\n      if (this.isFilterChainRouteActive[0]) color = this.colors.purple.light;else {\n        color = this.colors.pink.glow;\n      }\n      return {\n        background: color,\n        border: '.1vw solid ' + this.colors.gray.dark\n      };\n    },\n    button_2: function button_2() {\n      var color = '';\n      if (this.isFilterChainRouteActive[1]) color = this.colors.green.medium;else {\n        color = this.colors.pink.glow;\n      }\n      return {\n        background: color,\n        border: '.1vw solid ' + this.colors.gray.dark\n      };\n    },\n    button_3: function button_3() {\n      var color = '';\n      if (this.isFilterChainRouteActive[2]) color = this.colors.pink.light;else {\n        color = this.colors.pink.glow;\n      }\n      return {\n        background: color,\n        border: '.1vw solid ' + this.colors.gray.dark\n      };\n    }\n  },\n  methods: {\n    //--------DRAG AND DROP METHODS--------\n    handleDrop: function handleDrop(event, target) {\n      if (this.modulators[target] === null) {\n        var data = JSON.parse(event.dataTransfer.getData(\"data\"));\n        //if i'm not trying to link an evelope to volume\n        if (!(target === 'vol' && data.type === 'envelope')) {\n          //console.log(\"Dropping on \" + target)\n          //console.log(data)\n          this.modulators[target] = {\n            color: data.color,\n            id: data.id,\n            type: data.type\n          };\n          document.dispatchEvent(new CustomEvent(\"link\", {\n            detail: {\n              object: this.synth,\n              target: target,\n              color: this.color[target][\"medium\"],\n              modulator: {\n                type: this.modulators[target].type,\n                id: this.modulators[target].id\n              }\n            }\n          }));\n        }\n      }\n    },\n    handleDragEnter: function handleDragEnter(target) {\n      //todo: highlight object when dragging on it\n      //console.log(\"Dragging over \" + target)\n    },\n    handleDragLeave: function handleDragLeave(target) {\n      //console.log(\"Dragging out of \" + target)\n    },\n    unlinkMod: function unlinkMod(target) {\n      //todo: CALL BACK ENVELOPS TO UNLINK\n      document.dispatchEvent(new CustomEvent(\"unLink\", {\n        detail: {\n          object: this.synth,\n          target: target,\n          modulator: {\n            type: this.modulators[target].type,\n            id: this.modulators[target].id\n          }\n        }\n      }));\n\n      //re-hide link dot\n      this.modulators[target] = null;\n    },\n    //--------DRAG AND DROP STYLING--------\n    computedModulation: function computedModulation(target) {\n      switch (target) {\n        case \"vol\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\",\n              right: \"0%\"\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\"\n            };\n          }\n        case \"mod\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\"\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\"\n            };\n          }\n        case \"pitch\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\",\n              left: \"0%\",\n              bottom: \"0%\"\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\"\n            };\n          }\n      }\n    },\n    computedModText: function computedModText(target) {\n      if (this.modulators[target]) {\n        return this.modulators[target].id;\n      } else return \"\";\n    },\n    //-----------------\n    dispose: function dispose() {\n      //unlink linked modulators\n      for (var key in this.modulators) {\n        if (this.modulators[key]) this.unlinkMod(key);\n      }\n      this.$emit(\"disposed\", this.id);\n      this.synth.disconnectDispose();\n      this.synths.list.splice(this.synths.list.indexOf(this.synth), 1);\n\n      //console.log(\"Synth to remove is at index: \" + this.synths.list.indexOf(this.synth))\n      //console.log(\"list of synths remaining:\")\n      //console.log(this.synths.list)\n    },\n    initConnections: function initConnections() {\n      this.gainNode.connect(this.filterChains[0][0].getToneFilter());\n    },\n    // ----------- GRAPHIC HELPERS -----------\n    resizeGraphics: function resizeGraphics() {\n      var width = document.body.clientWidth;\n      if (width >= 500) {\n        this.wave_icon_size = 32 * width / 1500;\n      } else {\n        this.wave_icon_size = 0;\n      }\n    },\n    // ---------- USER EVENTS ---------------\n    // Audio routing changed clicking the dots that represent the filter chains\n    onChainclick: function onChainclick(id) {\n      //console.log(\"chain click - id: \" + id);\n      try {\n        if (this.isFilterChainRouteActive[id]) {\n          /*\r\n          console.log(\r\n              \"disconnect from: \" +\r\n              this.filterChains[id][0] + \" \" + id\r\n          );\r\n          */\n          this.gainNode.disconnect(this.filterChains[id][0].getToneFilter());\n        } else {\n          /*\r\n          console.log(\r\n            \"connect to: \" +\r\n            this.filterChains[id][0] + \" \" + id\r\n          );\r\n          */\n          this.gainNode.connect(this.filterChains[id][0].getToneFilter());\n        }\n      } catch (e) {\n        console.log(\"error: \" + e + \"\\nCHAIN CONNECTION TO OSC UNSUCCESSFUL. Can't connect to \" + this.filterChains[id][0]);\n      }\n      this.isFilterChainRouteActive[id] = !this.isFilterChainRouteActive[id];\n    },\n    onMouseMove: function onMouseMove(event) {\n      if (this.is_volumeDown) {\n        // RIGHT FADER - volume\n        if (event.movementY < 0) {\n          // Mouse is moving up\n          this.volume = Math.max(this.volume + event.movementY / 100, 0);\n        } else {\n          // Mouse is moving down\n          this.volume = Math.min(this.volume + event.movementY / 100, 1);\n        }\n        // -------------- modify here synth audio ----------------\n        // this.synth.volume.value = gainToDb(1 - this.volume);\n        this.synth.setParameters({\n          volume: gainToDb(1 - this.volume)\n        });\n        //console.log(\"synth volume: \" + this.volume.toFixed(2) + \" dB\");\n      } else if (this.is_modulationDown) {\n        // LEFT FADER - modulation\n        if (event.movementY < 0) {\n          // Mouse is moving down\n          this.modulation = Math.max(this.modulation + event.movementY / 100, 0);\n        } else {\n          // Mouse is moving up\n          this.modulation = Math.min(this.modulation + event.movementY / 100, 1);\n        }\n        // -------------- modify here synth audio ----------------\n        // (1- this.modulation) needed because the graphics return a value of 1 for the minimum and 0 for the max\n        this.synth.setParameters({\n          modulation: 1 - this.modulation\n        });\n        //console.log(\"modulation: \" + (1 -  this.modulation.toFixed(2)));\n      } else if (this.is_pitchDown) {\n        // BOTTOM FADER - pitch shift\n        if (event.movementX < 0) {\n          // Mouse is moving right\n          this.pitch = Math.min(this.pitch - Math.floor(event.movementX), this.maxPitch);\n        } else if (event.movementX > 0) {\n          // Mouse is moving left\n          this.pitch = Math.max(this.pitch - Math.floor(event.movementX), this.minPitch);\n        }\n        // ----------- modify here synth audio -------------\n        // todo: pitch max a dx e min a sx - meglio il contrario, secondo me - segue possibile ma brutto fix\n        // console.log(\"pitch shift: \" + this.pitch * -1)\n        // this.synth.set({detune: this.pitch * -100});\n        //console.log(\"pitch shift: \" + this.pitch);\n        this.synth.setParameters({\n          transpose: this.pitch\n        });\n        // -------------------------------------------------\n      }\n    },\n    onMouseUp: function onMouseUp(event) {\n      if (this.is_modulationDown) this.is_modulationDown = false;\n      if (this.is_volumeDown) this.is_volumeDown = false;\n      if (this.is_pitchDown) this.is_pitchDown = false;\n    },\n    modulationDown: function modulationDown(event) {\n      if (!this.is_modulationDown) this.is_modulationDown = true;\n    },\n    volumeDown: function volumeDown(event) {\n      if (!this.is_volumeDown) this.is_volumeDown = true;\n    },\n    pitchDown: function pitchDown(event) {\n      if (!this.is_pitchDown) this.is_pitchDown = true;\n    },\n    // ----------- AUDIO -----------\n    // Update osc waveform\n    nextOscType: function nextOscType() {\n      // go circularly on along the list osc_types list\n      this.oscTypeIndex++;\n      if (this.oscTypeIndex >= osc_types.length) this.oscTypeIndex = 0;\n      this.synth.setParameters({\n        type: osc_types[this.oscTypeIndex]\n      });\n\n      //console.log(\"osc type: \" + osc_types[this.oscTypeIndex]);\n    },\n    nextWaveform: function nextWaveform() {\n      // update selected wavetype changing the current index\n      this.oscWaveIndex++;\n      if (this.oscWaveIndex >= wave_types.length) this.oscWaveIndex = 0;\n\n      //console.log(wave_types[this.oscWaveIndex])\n      // set new waveform\n      this.synth.setParameters({\n        waveform: wave_types[this.oscWaveIndex]\n      });\n    },\n    // set routing\n    connect: function connect(route) {\n      this.synth.connect(route);\n    }\n  },\n  unmounted: function unmounted() {\n    // remove event listeners\n    window.removeEventListener(\"resize\", this.resizeGraphics);\n    document.removeEventListener(\"mousemove\", this.onMouseMove);\n    document.removeEventListener(\"mouseup\", this.onMouseUp);\n  }\n};","map":{"version":3,"mappings":"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","names":["Tone","SineIcon","SquareIcon","TriangleIcon","SawtoothIcon","gainToDb","MyPolySynth","wave_types","osc_types","components","data","color","vol","colors","pink","mod","azure","pitch","green","volume","modulation","pan","attack","decay","sustain","release","maxPitch","minPitch","partials","oscWaveIndex","oscTypeIndex","waveform_btn_style","wave_icon_size","is_modulationDown","is_volumeDown","is_pitchDown","isFilterChainRouteActive","modulators","props","mounted","document","addEventListener","onMouseMove","onMouseUp","window","resizeGraphics","gainNode","Gain","synth","polyphonyVoices","setParameters","synths","list","push","id","initConnections","$emit","computed","osc_container","background","type_button","fontSize","glow","type_text","gray","dark","volume_area","mod_area","medium","pitch_area","mod_slider","transform","opacity","volume_slider","backgroundColor","pitch_slider","pitch_hand","borderLeft","osc_wave","border","lineL","lineU","lineR","chain_buttons","button_1","purple","light","button_2","button_3","methods","handleDrop","event","target","JSON","parse","dataTransfer","getData","type","dispatchEvent","CustomEvent","detail","object","modulator","handleDragEnter","handleDragLeave","unlinkMod","computedModulation","width","height","borderRadius","position","right","display","left","bottom","computedModText","dispose","key","disconnectDispose","splice","indexOf","connect","filterChains","getToneFilter","body","clientWidth","onChainclick","disconnect","e","console","log","movementY","Math","max","min","movementX","floor","transpose","modulationDown","volumeDown","pitchDown","nextOscType","length","nextWaveform","waveform","route","unmounted","removeEventListener"],"sourceRoot":"","sources":["C:\\Home\\Projects\\Programmazione\\WebStorm\\myZenythPolisinT\\zenyth_polisint\\src\\views\\Synth\\Oscillators\\Osc.vue"],"sourcesContent":["<template>\r\n  <!-- PLEASE DON'T GO CRAZY TRYING UNDERSTAND THIS DIVs LAYER STACKS XD, Look into OSC MIDDLE-->\r\n  <!-- IN \"osc_middle\" there are the movable circle slider crowns : : 'mod_slider' / 'volume_slider' -->\r\n  <div class=\"main_container\" @click.shift=\"dispose\">\r\n    <div class=\"type_button\" @click=\"nextOscType\" :style=\"this.type_button\">\r\n      <div class=\"innertext\" :style=\"this.type_text\">{{\r\n        osc_types[true] === \"\" ? 'std' : osc_types[this.oscTypeIndex]\r\n      }}\r\n      </div>\r\n    </div>\r\n    <!-- DO NOT TOUCH EVER AGAIN HTML STRUCTURE / CSS !!!!!!!!!!!!-->\r\n    <div class=\"osc_container\" :style=\"osc_container\">\r\n      <div class=\"osc\">\r\n        <div class=\"osc_back\">\r\n          <div class=\"mod_area\" :style=\"this.mod_area\"></div>\r\n          <div class=\"volume_area\" :style=\"this.volume_area\"></div>\r\n          <div class=\"pitch_slider\" :style=\"this.pitch_slider\"></div>\r\n        </div>\r\n        <div class=\"osc_middle\">\r\n\r\n          <div class=\"mod_slider\" ref=\"modulation\" :style=\"this.mod_slider\"></div>\r\n          <div class=\"volume_slider\" ref=\"volume\" :style=\"this.volume_slider\"></div>\r\n        </div>\r\n        <div class=\"osc_front\">\r\n          <div class=\"pitch_area\" :style=\"this.pitch_area\"></div>\r\n          <div class=\"pitch_hand\" ref=\"pitch\" :style=\"this.pitch_hand\"></div>\r\n          <div class=\"lineL\" :style=\"this.lineL\"></div>\r\n          <div class=\"lineU\" :style=\"this.lineU\"></div>\r\n          <div class=\"lineR\" :style=\"this.lineR\"></div>\r\n        </div>\r\n        <div class=\"draggable left\" @dragenter=\"handleDragEnter('mod')\" @dragleave=\"handleDragLeave('mod')\"\r\n          @dragenter.prevent @dragover.prevent @drop=\"handleDrop($event, 'mod')\" @mousedown=\"modulationDown\">\r\n          <div class=\"modDot\" :style=\"computedModulation('mod')\" @click.shift.stop=\"unlinkMod('mod')\"\r\n            v-text=\"computedModText('mod')\"></div>\r\n        </div>\r\n        <div class=\"draggable right\" @dragenter=\"handleDragEnter('vol')\" @dragleave=\"handleDragLeave('vol')\"\r\n          @dragenter.prevent @dragover.prevent @drop=\"handleDrop($event, 'vol')\" @mousedown=\"volumeDown\">\r\n          <div class=\"modDot\" :style=\"computedModulation('vol')\" @click.shift.stop=\"unlinkMod('vol')\"\r\n            v-text=\"computedModText('vol')\"></div>\r\n        </div>\r\n        <div class=\"draggable low\" @dragenter=\"handleDragEnter('pitch')\" @dragleave=\"handleDragLeave('pitch')\"\r\n          @dragenter.prevent @dragover.prevent @drop=\"handleDrop($event, 'pitch')\" @mousedown=\"pitchDown\">\r\n          <div class=\"modDot\" :style=\"computedModulation('pitch')\" @click.shift.stop=\"unlinkMod('pitch')\"\r\n            v-text=\"computedModText('pitch')\"></div>\r\n        </div>\r\n        <div class=\"osc_wave\" @click=\"nextWaveform\" :style=\"this.osc_wave\">\r\n          <img v-if=\"this.oscWaveIndex === 0\" src=\"@/icons/sine.svg\" alt=\"\" draggable=\"false\">\r\n          <img v-if=\"this.oscWaveIndex === 1\" src=\"@/icons/triangle.svg\" alt=\"\" draggable=\"false\">\r\n          <img v-if=\"this.oscWaveIndex === 2\" src=\"@/icons/saw.svg\" alt=\"\" draggable=\"false\">\r\n          <img v-if=\"this.oscWaveIndex === 3\" src=\"@/icons/square.svg\" alt=\"\" draggable=\"false\">\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <div class=\"chain_buttons\" :style=\"chain_buttons\">\r\n      <div></div>\r\n      <div class=\"button_1\" :style=\"button_1\" @click=\"this.onChainclick(0)\"></div>\r\n      <div class=\"button_2\" :style=\"button_2\" @click=\"this.onChainclick(1)\"></div>\r\n      <div class=\"button_3\" :style=\"button_3\" @click=\"this.onChainclick(2)\"></div>\r\n      <div></div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as Tone from \"tone\";\r\nimport SineIcon from \"vue-material-design-icons/SineWave\";\r\nimport SquareIcon from \"vue-material-design-icons/SquareWave\";\r\nimport TriangleIcon from \"vue-material-design-icons/TriangleWave\";\r\nimport SawtoothIcon from \"vue-material-design-icons/SawtoothWave\";\r\nimport {gainToDb} from \"tone\";\r\nimport MyPolySynth from \"./MyPolySynth.js\";\r\n\r\nconst wave_types = [\"sine\", \"triangle\", \"sawtooth\", \"square\"];\r\nconst osc_types = [\"\", \"fm\", \"am\", \"fat\"];\r\n\r\nexport default {\r\n  components: {\r\n    SineIcon,\r\n    SquareIcon,\r\n    TriangleIcon,\r\n    SawtoothIcon,\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      // todo: UPDATE ALL COLOR DEPENDING ON THIS:\r\n      color: {\r\n        vol: this.colors.pink,\r\n        mod: this.colors.azure,\r\n        pitch: this.colors.green\r\n      },\r\n\r\n\r\n      // waveform_btn_style: osc_background_colors[0], todo: colors?\r\n      osc_types: [\"std\", \"fm\", \"am\", \"fat\"],\r\n      volume: 0.5,\r\n      modulation: 1,\r\n      pitch: 0,\r\n      pan: 0,\r\n      attack: 0.01,\r\n      decay: 0.1,\r\n      sustain: 1,\r\n      release: 0.2,\r\n      maxPitch: 24,\r\n      minPitch: -24,\r\n      partials: \"\",\r\n      oscWaveIndex: 0, // wave currently selected from  ['sine','triangle', ...]\r\n      oscTypeIndex: 0, // type of osc selected from ['std', 'fm', ...];\r\n      waveform_btn_style: \"lightblue\",\r\n      wave_icon_size: 32,\r\n      is_modulationDown: false,\r\n      is_volumeDown: false,\r\n      is_pitchDown: false,\r\n      isFilterChainRouteActive: [true, false, false],\r\n      modulators: {\r\n        vol: null,\r\n        mod: null,\r\n        pitch: null\r\n      },\r\n    };\r\n  },\r\n  props: [\"id\"],\r\n\r\n  mounted() {\r\n    document.addEventListener(\"mousemove\", this.onMouseMove);\r\n    document.addEventListener(\"mouseup\", this.onMouseUp);\r\n    window.addEventListener(\"resize\", this.resizeGraphics);\r\n\r\n    // resize graphics\r\n    this.resizeGraphics();\r\n    this.gainNode = new Tone.Gain();\r\n    //console.log(this.polyphonyVoices)\r\n    this.synth = new MyPolySynth(this.gainNode, this.polyphonyVoices);\r\n    this.synth.setParameters({ volume: gainToDb(1 - this.volume) });\r\n\r\n    this.synths.list.push(this.synth)\r\n    //console.log(this.synths.list)\r\n    // we need to init connection to first filter chain\r\n    // in the first osc case we need to make sure we connect after the chain is created , so we handle that with events\r\n    // emitted from the filter chain - in all other cases we can just normally connect to the chain\r\n    if (this.id > 1) {\r\n      this.initConnections()\r\n    }\r\n    //communicate to parent that a new osc has been created (to update volEnvelope from ModHost)\r\n    this.$emit(\"newOsc\")\r\n\r\n  },\r\n\r\n  computed: {\r\n\r\n    osc_container() {\r\n      return {\r\n        background: '#f8e7e6'\r\n      }\r\n    },\r\n    /*------------ TYPE BUTTON ------------*/\r\n    type_button() {\r\n      return {\r\n        fontSize: '.5vw',\r\n        background: this.colors.pink.glow\r\n      }\r\n    },\r\n    type_text() {\r\n      return {\r\n        color: this.colors.gray.dark\r\n      }\r\n    },\r\n    /*--------------- OSC -----------------*/\r\n    volume_area() {\r\n      return {\r\n        background: this.colors.pink.dark\r\n      }\r\n    },\r\n    mod_area() {\r\n      return {\r\n        background: this.colors.azure.medium\r\n      }\r\n    },\r\n    pitch_area() {\r\n      return {\r\n        background: this.colors.green.glow\r\n      }\r\n    },\r\n    mod_slider() {\r\n      return {\r\n        transform: \"rotate(-\" + this.modulation * 111 + \"deg)\",\r\n        background: 'white',\r\n        opacity: '60%'\r\n      }\r\n    },\r\n    volume_slider() {\r\n      return {\r\n        backgroundColor: 'white',\r\n        opacity: '60%',\r\n        transform: \"rotate(\" + this.volume * 112 + \"deg)\",\r\n      }\r\n    },\r\n    pitch_slider() {\r\n      return {\r\n        background: this.colors.green.medium\r\n      }\r\n    },\r\n    pitch_hand() {\r\n      return {\r\n        transform: \"rotate(\" + (this.pitch * 50) / this.maxPitch + \"deg)\",\r\n        borderLeft: \".1vw solid \" + this.colors.green.dark\r\n      }\r\n    },\r\n    osc_wave() {\r\n      return {\r\n        border: '.1vw solid ' + this.colors.green.dark,\r\n        background: this.colors.green.glow\r\n      }\r\n    },\r\n    lineL() {\r\n      return {\r\n        transform: \"rotate(66deg)\",\r\n        borderLeft: \".1vw solid \" + this.colors.green.dark\r\n      }\r\n    },\r\n    lineU() {\r\n      return {\r\n        transform: \"rotate(-66deg)\",\r\n        borderLeft: \".1vw solid \" + this.colors.green.dark\r\n      }\r\n    },\r\n    lineR() {\r\n      return {\r\n        transform: \"rotate(180deg)\",\r\n        borderLeft: \".1vw solid \" + this.colors.green.dark\r\n      }\r\n    },\r\n    /*------------ CHAIN BUTTONS ------------*/\r\n    chain_buttons() {\r\n      return {\r\n        background: this.colors.pink.glow\r\n      }\r\n    },\r\n    button_1() {\r\n      let color = ''\r\n      if (this.isFilterChainRouteActive[0])\r\n        color = this.colors.purple.light\r\n      else {\r\n        color = this.colors.pink.glow\r\n      }\r\n      return {\r\n        background: color, \r\n        border: '.1vw solid ' + this.colors.gray.dark \r\n      }\r\n    },\r\n    button_2() {\r\n      let color = ''\r\n      if (this.isFilterChainRouteActive[1])\r\n        color = this.colors.green.medium\r\n      else {\r\n        color = this.colors.pink.glow\r\n      }\r\n      return {\r\n        background: color, \r\n        border: '.1vw solid ' + this.colors.gray.dark \r\n      }\r\n    },\r\n    button_3() {\r\n      let color = ''\r\n      if (this.isFilterChainRouteActive[2])\r\n        color = this.colors.pink.light\r\n      else {\r\n        color = this.colors.pink.glow\r\n      }\r\n      return {\r\n        background: color, \r\n        border: '.1vw solid ' + this.colors.gray.dark \r\n      }\r\n    },\r\n  },\r\n\r\n  methods: {\r\n\r\n    //--------DRAG AND DROP METHODS--------\r\n    handleDrop(event, target) {\r\n      if (this.modulators[target] === null) {\r\n        let data = JSON.parse(event.dataTransfer.getData(\"data\"));\r\n        //if i'm not trying to link an evelope to volume\r\n        if (!(target === 'vol' && data.type === 'envelope')) {\r\n          //console.log(\"Dropping on \" + target)\r\n          //console.log(data)\r\n          this.modulators[target] = {color: data.color, id: data.id, type: data.type}\r\n          document.dispatchEvent(new CustomEvent(\"link\", {\r\n                detail: {\r\n                  object: this.synth,\r\n                  target: target,\r\n                  color: this.color[target][\"medium\"],\r\n                  modulator: {type: this.modulators[target].type, id: this.modulators[target].id}\r\n                }\r\n              }\r\n          ))\r\n        }\r\n      }\r\n\r\n    },\r\n    handleDragEnter(target) {\r\n      //todo: highlight object when dragging on it\r\n      //console.log(\"Dragging over \" + target)\r\n    },\r\n    handleDragLeave(target) {\r\n      //console.log(\"Dragging out of \" + target)\r\n    },\r\n    unlinkMod(target) {\r\n      //todo: CALL BACK ENVELOPS TO UNLINK\r\n      document.dispatchEvent(new CustomEvent(\"unLink\", {\r\n            detail: {\r\n              object: this.synth,\r\n              target: target,\r\n              modulator: {type: this.modulators[target].type, id: this.modulators[target].id}\r\n            }\r\n          }\r\n      ))\r\n\r\n      //re-hide link dot\r\n      this.modulators[target] = null;\r\n\r\n    },\r\n    //--------DRAG AND DROP STYLING--------\r\n    computedModulation(target) {\r\n      switch (target) {\r\n        case \"vol\":\r\n          if (this.modulators[target]) {\r\n            return {\r\n              width: \"1vw\",\r\n              height: \"1vw\",\r\n              borderRadius: \"50%\",\r\n              backgroundColor: this.modulators[target].color,\r\n              position: \"absolute\",\r\n              right: \"0%\",\r\n            };\r\n          } else {\r\n            return {\r\n              display: \"none\",\r\n              width: \"0%\",\r\n              height: \"0%\",\r\n            }\r\n          }\r\n\r\n        case \"mod\":\r\n          if (this.modulators[target]) {\r\n            return {\r\n              width: \"1vw\",\r\n              height: \"1vw\",\r\n              borderRadius: \"50%\",\r\n              backgroundColor: this.modulators[target].color,\r\n              position: \"absolute\",\r\n            };\r\n          } else {\r\n            return {\r\n              display: \"none\",\r\n              width: \"0%\",\r\n              height: \"0%\",\r\n            }\r\n          }\r\n        case \"pitch\":\r\n          if (this.modulators[target]) {\r\n            return {\r\n              width: \"1vw\",\r\n              height: \"1vw\",\r\n              borderRadius: \"50%\",\r\n              backgroundColor: this.modulators[target].color,\r\n              position: \"absolute\",\r\n              left: \"0%\",\r\n              bottom: \"0%\"\r\n            };\r\n          } else {\r\n            return {\r\n              display: \"none\",\r\n              width: \"0%\",\r\n              height: \"0%\",\r\n            }\r\n          }\r\n      }\r\n    },\r\n    computedModText(target) {\r\n      if (this.modulators[target]) {\r\n        return this.modulators[target].id\r\n      } else return \"\";\r\n    },\r\n\r\n\r\n\r\n    //-----------------\r\n    dispose() {\r\n      //unlink linked modulators\r\n      for (let key in this.modulators) {\r\n        if (this.modulators[key])\r\n          this.unlinkMod(key)\r\n      }\r\n\r\n      this.$emit(\"disposed\", this.id)\r\n      this.synth.disconnectDispose()\r\n      this.synths.list.splice(this.synths.list.indexOf(this.synth), 1)\r\n\r\n\r\n      //console.log(\"Synth to remove is at index: \" + this.synths.list.indexOf(this.synth))\r\n      //console.log(\"list of synths remaining:\")\r\n      //console.log(this.synths.list)\r\n    },\r\n    initConnections() {\r\n      this.gainNode.connect(this.filterChains[0][0].getToneFilter())\r\n    },\r\n\r\n    // ----------- GRAPHIC HELPERS -----------\r\n    resizeGraphics() {\r\n      let width = document.body.clientWidth;\r\n      if (width >= 500) {\r\n        this.wave_icon_size = (32 * width) / 1500;\r\n      } else {\r\n        this.wave_icon_size = 0;\r\n      }\r\n    },\r\n\r\n    // ---------- USER EVENTS ---------------\r\n    // Audio routing changed clicking the dots that represent the filter chains\r\n    onChainclick(id) {\r\n      //console.log(\"chain click - id: \" + id);\r\n      try {\r\n        if (this.isFilterChainRouteActive[id]) {\r\n          /*\r\n          console.log(\r\n              \"disconnect from: \" +\r\n              this.filterChains[id][0] + \" \" + id\r\n          );\r\n          */\r\n          this.gainNode.disconnect(\r\n              this.filterChains[id][0].getToneFilter()\r\n          );\r\n        } else {\r\n          /*\r\n          console.log(\r\n            \"connect to: \" +\r\n            this.filterChains[id][0] + \" \" + id\r\n          );\r\n          */\r\n          this.gainNode.connect(\r\n              this.filterChains[id][0].getToneFilter()\r\n          );\r\n        }\r\n      } catch (e) {\r\n        console.log(\r\n          \"error: \" + e + \"\\nCHAIN CONNECTION TO OSC UNSUCCESSFUL. Can't connect to \" + this.filterChains[id][0]\r\n        );\r\n      }\r\n      this.isFilterChainRouteActive[id] = !this.isFilterChainRouteActive[id];\r\n    },\r\n\r\n    onMouseMove(event) {\r\n      if (this.is_volumeDown) {\r\n        // RIGHT FADER - volume\r\n        if (event.movementY < 0) {\r\n          // Mouse is moving up\r\n          this.volume = Math.max(this.volume + event.movementY / 100, 0);\r\n        } else {\r\n          // Mouse is moving down\r\n          this.volume = Math.min(this.volume + event.movementY / 100, 1);\r\n        }\r\n        // -------------- modify here synth audio ----------------\r\n        // this.synth.volume.value = gainToDb(1 - this.volume);\r\n        this.synth.setParameters({ volume: gainToDb(1 - this.volume) });\r\n        //console.log(\"synth volume: \" + this.volume.toFixed(2) + \" dB\");\r\n      } else if (this.is_modulationDown) {\r\n        // LEFT FADER - modulation\r\n        if (event.movementY < 0) {\r\n          // Mouse is moving down\r\n          this.modulation = Math.max(this.modulation + event.movementY / 100, 0);\r\n        } else {\r\n          // Mouse is moving up\r\n          this.modulation = Math.min(this.modulation + event.movementY / 100, 1);\r\n        }\r\n        // -------------- modify here synth audio ----------------\r\n        // (1- this.modulation) needed because the graphics return a value of 1 for the minimum and 0 for the max\r\n        this.synth.setParameters({modulation: 1 - this.modulation })\r\n        //console.log(\"modulation: \" + (1 -  this.modulation.toFixed(2)));\r\n      } else if (this.is_pitchDown) {\r\n        // BOTTOM FADER - pitch shift\r\n        if (event.movementX < 0) {\r\n          // Mouse is moving right\r\n          this.pitch = Math.min(this.pitch - Math.floor(event.movementX), this.maxPitch);\r\n        } else if (event.movementX > 0) {\r\n          // Mouse is moving left\r\n          this.pitch = Math.max(this.pitch - Math.floor(event.movementX), this.minPitch);\r\n        }\r\n        // ----------- modify here synth audio -------------\r\n        // todo: pitch max a dx e min a sx - meglio il contrario, secondo me - segue possibile ma brutto fix\r\n        // console.log(\"pitch shift: \" + this.pitch * -1)\r\n        // this.synth.set({detune: this.pitch * -100});\r\n        //console.log(\"pitch shift: \" + this.pitch);\r\n        this.synth.setParameters({ transpose: this.pitch });\r\n        // -------------------------------------------------\r\n      }\r\n    },\r\n    onMouseUp(event) {\r\n      if (this.is_modulationDown) this.is_modulationDown = false;\r\n      if (this.is_volumeDown) this.is_volumeDown = false;\r\n      if (this.is_pitchDown) this.is_pitchDown = false;\r\n    },\r\n\r\n    modulationDown(event) {\r\n      if (!this.is_modulationDown) this.is_modulationDown = true;\r\n    },\r\n    volumeDown(event) {\r\n      if (!this.is_volumeDown) this.is_volumeDown = true;\r\n    },\r\n    pitchDown(event) {\r\n      if (!this.is_pitchDown) this.is_pitchDown = true;\r\n    },\r\n\r\n    // ----------- AUDIO -----------\r\n    // Update osc waveform\r\n    nextOscType() {\r\n      // go circularly on along the list osc_types list\r\n      this.oscTypeIndex++;\r\n      if (this.oscTypeIndex >= osc_types.length) this.oscTypeIndex = 0;\r\n\r\n      this.synth.setParameters({ type: osc_types[this.oscTypeIndex] })\r\n\r\n      //console.log(\"osc type: \" + osc_types[this.oscTypeIndex]);\r\n    },\r\n\r\n    nextWaveform() {\r\n      // update selected wavetype changing the current index\r\n      this.oscWaveIndex++;\r\n      if (this.oscWaveIndex >= wave_types.length) this.oscWaveIndex = 0;\r\n\r\n      //console.log(wave_types[this.oscWaveIndex])\r\n      // set new waveform\r\n      this.synth.setParameters({ waveform: wave_types[this.oscWaveIndex] })\r\n    },\r\n\r\n    // set routing\r\n    connect(route) {\r\n      this.synth.connect(route);\r\n    },\r\n  },\r\n\r\n  unmounted() {\r\n    // remove event listeners\r\n    window.removeEventListener(\"resize\", this.resizeGraphics);\r\n    document.removeEventListener(\"mousemove\", this.onMouseMove);\r\n    document.removeEventListener(\"mouseup\", this.onMouseUp);\r\n  },\r\n};\r\n</script>\r\n\r\n<style scoped>\r\n.modDot {\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  font-size: 0.8vw;\r\n  text-align: center;\r\n  box-sizing: border-box;\r\n  border: .06vw solid black;\r\n}\r\n\r\n.main_container {\r\n  border: .1vw solid #c2847b ;\r\n  box-sizing: border-box;\r\n  height: calc(100% / 3);\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n.main_container:hover {\r\n  border: .1vw solid #63443e;\r\n  box-sizing: border-box;\r\n  height: calc(100% / 3);\r\n  display: flex;\r\n  flex-direction: row;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n\r\n.osc_container {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: center;\r\n  position: relative;\r\n  flex: 4;\r\n  height: 100%;\r\n  width: 100%;\r\n}\r\n\r\n/*---------- MOD TYPE BUTTON ----------*/\r\n.type_button {\r\n  border: .1vw solid #c2847b;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  flex: 1;\r\n  height: 100%;\r\n}\r\n.type_button:hover {\r\n  border: .1vw solid #63443e;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  flex: 1;\r\n  height: 100%;\r\n}\r\n\r\n.type_button .innertext {\r\n  font-size: .8vw;\r\n  writing-mode: vertical-rl;\r\n  text-orientation: upright;\r\n  text-transform: uppercase;\r\n}\r\n\r\n/*--------------- OSC -----------------*/\r\n.osc {\r\n  width: 90%;\r\n  justify-content: center;\r\n  align-items: center;\r\n  display: flex;\r\n  position: relative;\r\n  aspect-ratio: 1/1;\r\n}\r\n\r\n.osc_back {\r\n  margin: auto;\r\n  width: 100%;\r\n  position: absolute;\r\n  aspect-ratio: 1/1;\r\n  clip-path: circle(50%);\r\n  z-index: 1;\r\n}\r\n\r\n.pitch_slider {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  clip-path: polygon(50% 100%, 100% 100%, 100% 72%, 50% 50%, 0% 72%, 0% 100%);\r\n  z-index: 27;\r\n}\r\n\r\n.mod_area {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  clip-path: polygon(50% 0%, 0% 0%, 0% 100%, 50% 50%);\r\n  z-index: 2;\r\n}\r\n\r\n.volume_area {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 50%);\r\n  z-index: 3;\r\n}\r\n\r\n.osc_middle {\r\n  margin: auto;\r\n  height: 95%;\r\n  top: 2.5%;\r\n  left: 2.5%;\r\n  position: absolute;\r\n  aspect-ratio: 1/1;\r\n  clip-path: circle(50%);\r\n  z-index: 25;\r\n}\r\n\r\n.mod_slider {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  clip-path: polygon(50% 0%, 0% 0%, 0% 100%, 50% 50%);\r\n  z-index: 27;\r\n}\r\n\r\n.volume_slider {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 50%);\r\n  z-index: 26;\r\n}\r\n\r\n.osc_front {\r\n  margin: auto;\r\n  height: 96%;\r\n  top: 2%;\r\n  left: 2%;\r\n  position: absolute;\r\n  aspect-ratio: 1/1;\r\n  clip-path: circle(50%);\r\n  z-index: 50;\r\n}\r\n\r\n.pitch_area {\r\n  position: absolute;\r\n  width: 100%;\r\n  height: 100%;\r\n  clip-path: polygon(50% 100%,\r\n      100% 100%,\r\n      100% 72%,\r\n      50% 50%,\r\n      0% 72%,\r\n      0% 100%,\r\n      50% 100%);\r\n  z-index: 10;\r\n}\r\n\r\n.pitch_hand {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  height: 40%;\r\n  width: 100%;\r\n  transform-origin: 0 0;\r\n  z-index: 15;\r\n}\r\n.lineL {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  height: 100%;\r\n  width: 100%;\r\n  transform-origin: 0 0;\r\n  z-index: 15;\r\n}\r\n\r\n.lineU {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  height: 100%;\r\n  width: 100%;\r\n  transform-origin: 0 0;\r\n  z-index: 15;\r\n}\r\n.lineR {\r\n  position: absolute;\r\n  top: 50%;\r\n  left: 50%;\r\n  height: 100%;\r\n  width: 100%;\r\n  transform-origin: 0 0;\r\n  z-index: 15;\r\n}\r\n\r\n\r\n.osc_wave {\r\n  display: flex;\r\n  position: relative;\r\n  aspect-ratio: 1;\r\n  width: 45%;\r\n  border-radius: 50%;\r\n  left: 0;\r\n  top: 0;\r\n  z-index: 101;\r\n}\r\n\r\n.osc_wave img {\r\n  position: relative;\r\n  aspect-ratio: 1/1;\r\n  width: 100%;\r\n  left: 0;\r\n  top: 0;\r\n  clip-path: circle(20%);\r\n  z-index: 102;\r\n}\r\n\r\n.draggable {\r\n  position: absolute;\r\n  z-index: 75;\r\n}\r\n\r\n.left {\r\n  width: 50%;\r\n  height: 70%;\r\n  left: 0;\r\n  bottom: 30%;\r\n  background-color: transparent;\r\n}\r\n\r\n.right {\r\n  width: 50%;\r\n  height: 70%;\r\n  background-color: transparent;\r\n  left: 50%;\r\n  bottom: 30%\r\n}\r\n\r\n.low {\r\n  width: 100%;\r\n  height: 30%;\r\n  top: 70%;\r\n  background-color: transparent;\r\n}\r\n\r\n/*------------ CHAIN BUTTONS ------------*/\r\n.chain_buttons {\r\n  border: .1vw solid #c2847b;\r\n  flex: .5;\r\n  display: grid;\r\n  grid-template-rows: .3fr 1fr 1fr 1fr .3fr;\r\n  height: 100%;\r\n  align-items: center;\r\n  padding-left: 3%;\r\n  padding-right: 3%;\r\n}\r\n.chain_buttons:hover {\r\n  border: .1vw solid #63443e;\r\n  flex: .5;\r\n  display: grid;\r\n  grid-template-rows: .3fr 1fr 1fr 1fr .3fr;\r\n  height: 100%;\r\n  align-items: center;\r\n  padding-left: 3%;\r\n  padding-right: 3%;\r\n}\r\n\r\n\r\n.button_1,\r\n.button_2,\r\n.button_3 {\r\n  width: 100%;\r\n  aspect-ratio: 1/1;\r\n  border: .1vw solid black;\r\n  border-radius: 50%;\r\n}\r\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}