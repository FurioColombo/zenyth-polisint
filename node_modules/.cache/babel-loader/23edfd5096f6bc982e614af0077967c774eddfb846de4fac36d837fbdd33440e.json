{"ast":null,"code":"import { normalizeStyle as _normalizeStyle, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, createElementVNode as _createElementVNode, withModifiers as _withModifiers, pushScopeId as _pushScopeId, popScopeId as _popScopeId } from \"vue\";\nimport _imports_0 from '@/icons/blizzard.svg';\nimport _imports_1 from '@/icons/drop.svg';\nimport _imports_2 from '@/icons/fire.svg';\nimport _imports_3 from '@/icons/moon.svg';\nimport _imports_4 from '@/icons/wind.svg';\nimport _imports_5 from '@/icons/tornado.svg';\nconst _withScopeId = n => (_pushScopeId(\"data-v-7e3130a4\"), n = n(), _popScopeId(), n);\nconst _hoisted_1 = {\n  class: \"icon\"\n};\nconst _hoisted_2 = {\n  key: 1,\n  src: _imports_0,\n  alt: \"\"\n};\nconst _hoisted_3 = {\n  key: 2,\n  src: _imports_1,\n  alt: \"\"\n};\nconst _hoisted_4 = {\n  key: 3,\n  src: _imports_2,\n  alt: \"\"\n};\nconst _hoisted_5 = {\n  key: 4,\n  src: _imports_3,\n  alt: \"\"\n};\nconst _hoisted_6 = {\n  key: 5,\n  src: _imports_4,\n  alt: \"\"\n};\nconst _hoisted_7 = {\n  key: 6,\n  src: _imports_5,\n  alt: \"\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", {\n    class: \"cell\",\n    onClick: [_cache[3] || (_cache[3] = (...args) => $options.nextFx && $options.nextFx(...args)), _cache[4] || (_cache[4] = _withModifiers((...args) => $options.setToBypass && $options.setToBypass(...args), [\"shift\"]))],\n    onMousedown: _cache[5] || (_cache[5] = (...args) => $options.fxDown && $options.fxDown(...args))\n  }, [_createElementVNode(\"div\", _hoisted_1, [this.typeId === 0 ? (_openBlock(), _createElementBlock(\"div\", {\n    key: 0,\n    ref: \"plus\",\n    style: _normalizeStyle(this.iconDiv),\n    onMouseover: _cache[0] || (_cache[0] = (...args) => this.onIconEnter && this.onIconEnter(...args)),\n    onMouseout: _cache[1] || (_cache[1] = (...args) => $options.onIconLeave && $options.onIconLeave(...args))\n  }, \" +\", 36 /* STYLE, HYDRATE_EVENTS */)) : _createCommentVNode(\"v-if\", true), this.typeId === 1 ? (_openBlock(), _createElementBlock(\"img\", _hoisted_2)) : _createCommentVNode(\"v-if\", true), this.typeId === 2 ? (_openBlock(), _createElementBlock(\"img\", _hoisted_3)) : _createCommentVNode(\"v-if\", true), this.typeId === 3 ? (_openBlock(), _createElementBlock(\"img\", _hoisted_4)) : _createCommentVNode(\"v-if\", true), this.typeId === 4 ? (_openBlock(), _createElementBlock(\"img\", _hoisted_5)) : _createCommentVNode(\"v-if\", true), this.typeId === 5 ? (_openBlock(), _createElementBlock(\"img\", _hoisted_6)) : _createCommentVNode(\"v-if\", true), this.typeId === 6 ? (_openBlock(), _createElementBlock(\"img\", _hoisted_7)) : _createCommentVNode(\"v-if\", true)]), _createElementVNode(\"div\", {\n    class: \"glow\",\n    style: _normalizeStyle($options.computedGlowStyle),\n    onMousedown: _cache[2] || (_cache[2] = (...args) => $options.fxDown && $options.fxDown(...args))\n  }, null, 36 /* STYLE, HYDRATE_EVENTS */)], 32 /* HYDRATE_EVENTS */);\n}","map":{"version":3,"mappings":";OAIoCA,UAA0B;OAC1BC,UAAsB;OACtBC,UAAsB;OACtBC,UAAsB;OACtBC,UAAsB;OACtBC,UAAyB;;;EAPpDC,KAAK,EAAC;AAAM;;;EAEeC,GAA0B,EAA1BP,UAA0B;EAACQ,GAAG,EAAC;;;;EAC/BD,GAAsB,EAAtBN,UAAsB;EAACO,GAAG,EAAC;;;;EAC3BD,GAAsB,EAAtBL,UAAsB;EAACM,GAAG,EAAC;;;;EAC3BD,GAAsB,EAAtBJ,UAAsB;EAACK,GAAG,EAAC;;;;EAC3BD,GAAsB,EAAtBH,UAAsB;EAACI,GAAG,EAAC;;;;EAC3BD,GAAyB,EAAzBF,UAAyB;EAACG,GAAG,EAAC;;;uBARhEC,oBAYM;IAZDH,KAAK,EAAC,MAAM;IAAEI,OAAK,0CAAEC,2CAAM,yDAAgBA,qDAAW;IAAGC,WAAS,yCAAED,2CAAM;MAC7EE,oBAQM,OARNC,UAQM,QAPYC,MAAM,wBAAtBN,oBAA6H;;IAA/FO,GAAG,EAAC,MAAM;IAAEC,KAAK,uBAAOC,OAAO;IAAGC,WAAS,8CAAOC,WAAW,SAAXA,WAAW;IAAGC,UAAQ,yCAAEV,qDAAW;KAAE,IAAE,6EACvGI,MAAM,wBAAtBN,oBAAgE,OAAhEa,UAAgE,6CAChDP,MAAM,wBAAtBN,oBAA4D,OAA5Dc,UAA4D,6CAC5CR,MAAM,wBAAtBN,oBAA4D,OAA5De,UAA4D,6CAC5CT,MAAM,wBAAtBN,oBAA4D,OAA5DgB,UAA4D,6CAC5CV,MAAM,wBAAtBN,oBAA4D,OAA5DiB,UAA4D,6CAC5CX,MAAM,wBAAtBN,oBAA+D,OAA/DkB,UAA+D,0CAEjEd,oBACM;IADDP,KAAK,EAAC,MAAM;IAAEW,KAAK,kBAAEN,0BAAiB;IAAGC,WAAS,yCAAED,2CAAM","names":["_imports_0","_imports_1","_imports_2","_imports_3","_imports_4","_imports_5","class","src","alt","_createElementBlock","onClick","$options","onMousedown","_createElementVNode","_hoisted_1","typeId","ref","style","iconDiv","onMouseover","onIconEnter","onMouseout","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7"],"sourceRoot":"","sources":["/Users/guglielmofratticioli/Documents/POLIMI/FurioColombo.github.io/src/views/Synth/Effects/FxCell.vue"],"sourcesContent":["<template>\n  <div class=\"cell\" @click=\"nextFx\" @click.shift=\"setToBypass\" @mousedown=\"fxDown\">\n    <div class=\"icon\">\n      <div v-if=\"this.typeId === 0\" ref=\"plus\" :style=\"this.iconDiv\" @mouseover=\"this.onIconEnter\" @mouseout=\"onIconLeave\"> +</div>\n      <img v-if=\"this.typeId === 1\" src=\"@/icons/blizzard.svg\" alt=\"\">\n      <img v-if=\"this.typeId === 2\" src=\"@/icons/drop.svg\" alt=\"\">\n      <img v-if=\"this.typeId === 3\" src=\"@/icons/fire.svg\" alt=\"\">\n      <img v-if=\"this.typeId === 4\" src=\"@/icons/moon.svg\" alt=\"\">\n      <img v-if=\"this.typeId === 5\" src=\"@/icons/wind.svg\" alt=\"\">\n      <img v-if=\"this.typeId === 6\" src=\"@/icons/tornado.svg\" alt=\"\">\n    </div>\n    <div class=\"glow\" :style=\"computedGlowStyle\" @mousedown=\"fxDown\">\n    </div>\n  </div>\n</template>\n\n<script>\nimport { isSVGTag } from '@vue/shared';\nimport MyEffect from \"@/views/Synth/Effects/MyFx\";\nimport {Gain, getDestination} from \"tone\";\nimport { nextTick } from \"vue\";\n\nconst types = ['none', 'reverb', 'delay', 'distortion', 'vibrato', 'pan', 'chorus'];\nconst Fx_colors = ['transparent', 'lightblue', 'deepskyblue', 'red', 'orange', 'darkorchid', 'yellow'];\nexport default {\n  props: [\"chainId\", \"id\", \"ref\"],\n\n  data() {\n    return {\n      modulation: 0,\n      is_down: false,\n      typeId: 0,\n      volume: 0,\n\n      //variables to solve\n      //dragging and clicking interference\n      startX: 0,\n      startY: 0,\n      endX: 0,\n      endY: 0,\n      threshold: 2, // adjust as needed\n    };\n  },\n  mounted() {\n    // gesture listeners\n    document.addEventListener(\"mouseup\", this.onMouseup);\n    document.addEventListener(\"mousemove\", this.onMousemove);\n    // init effect as bypass (a gain node)\n    this.effect = new MyEffect({ typeId: types[this.typeId], modulation: this.modulation })\n    // this.effect = this.fxHelper.generateToneFx('none');\n    // create the effect in the global fx matrix\n    this.fxChains[this.chainId][this.id] = this.effect;\n    // console.log(\"fx chain: \" + this.chainId + \" - fx id: \" + this.id)\n    // console.log(this.chainId, \" \", this.id)\n\n    // notify parent that each filter has been created\n    if (this.chainId === this.nFxChains - 1 && this.id === this.nFxXchain) {\n      this.$emit(\"fxMounted\")\n    }\n  },\n\n  computed: {\n    computedGlowStyle() {\n      return {\n        opacity: (this.modulation + 0.3) * 100 + \"%\",\n        background: Fx_colors[this.typeId]\n      }\n    },\n    iconDiv() {\n      let color = 'black'\n      if (this.chainId === 0) color = this.colors.purple.medium\n      if (this.chainId === 1) color = this.colors.green.medium\n      if (this.chainId === 2) color = this.colors.pink.medium\n      return {\n        color: color,\n      }\n    },\n    iconDivBlack(){\n      let color = 'black'\n      return {\n        color: color,\n      }\n    },\n    onIconEnter() {\n      this.$refs['plus'].style.color = 'black'\n    },\n    onIconLeave() {\n      let color = 'black'\n      if (this.chainId === 0) color = this.colors.purple.medium\n      if (this.chainId === 1) color = this.colors.green.medium\n      if (this.chainId === 2) color = this.colors.pink.medium\n      this.$refs['plus'].style.color = color\n    }\n    /*     onIconLeave(){\n          let color = 'black'\n          if(this.chainId === 0 ) color = this.colors.purple.medium\n          if(this.chainId === 1 ) color = this.colors.green.medium\n          if(this.chainId === 2 ) color = this.colors.pink.medium\n          this.$refs['plus'].style.color = color\n        } */\n  },\n\n  components: { isSVGTag },\n\n  methods: {\n    // ------------------ USER INTERACTIONS -----------------------\n    nextFx() {\n      //calculate distance between mouseDown and mouseUp, if it is more than threshold pixels, then it is a drag\n      const distance = Math.sqrt(\n        Math.pow(this.endX - this.startX, 2) +\n        Math.pow(this.endY - this.startY, 2)\n      );\n\n      if (distance <= this.threshold) {\n        if (!this.is_down) {\n          // change fx type and index\n          this.typeId = this.generateNextTypeIndex();\n          let fxType = types[this.typeId]\n          //console.log(fxType)\n\n          this.changeFxType(fxType)\n        }\n      }\n\n    },\n\n    changeFxType(fxType) {\n      // disconnect old effect\n      this.effect.disconnect();\n      this.effect.dispose();\n\n      // create new effect\n      this.effect = new MyEffect({ type: fxType, modulation: this.modulation })\n      this.effect.setFxParams({ type: fxType, mod: this.modulation })\n\n      // attach new fx in the global fx matrix\n      // init effect\n      this.fxChains[this.chainId][this.id] = this.effect;\n      // connect effect\n      this.fxChains[this.chainId][this.id-1].connect(this.fxChains[this.chainId][this.id].getToneReference());\n      if(this.fxChains[this.chainId][this.id+1] instanceof MyEffect) {\n        this.fxChains[this.chainId][this.id].connect(this.fxChains[this.chainId][this.id + 1].getToneReference())\n      } else if(this.fxChains[this.chainId][this.id+1] instanceof Gain){\n        this.fxChains[this.chainId][this.id].connect(this.fxChains[this.chainId][this.id + 1])\n      }\n      //console.log(this.fxChains)\n\n      /* // debug global fx matrix\n      this.fxChains.forEach((chain) => {\n        chain.forEach((fx) => {\n          if (fx instanceof MyEffect){\n            console.log(fx.getToneReference())\n          } else { console.log(fx) }\n        })\n      })*/\n    },\n\n    generateRandomTypeIndex() {\n      return Math.round(Math.random() * 10 + 1) % types.length\n    },\n\n    generateNextTypeIndex() {\n      return (this.typeId + 1) % types.length;\n    },\n\n    setToBypass() {\n      this.typeId = 0;\n      this.changeFxType('none')\n\n      console.log(\"set fx in position \" + this.chainId + \" - \" + this.id + \" to bypass\")\n    },\n\n    fxDown(e) {\n      //save mouseDown position\n      this.startX = e.clientX;\n      this.startY = e.clientY;\n\n      if (!this.is_down)\n        this.is_down = true;\n    },\n    onMouseup(e) {\n      //save mouseUp position\n      this.endX = e.clientX;\n      this.endY = e.clientY;\n      if (this.is_down)\n        this.is_down = false;\n    },\n    onMousemove(event) {\n      if (this.is_down) {\n        if (event.movementY < 0) {\n          this.modulation = Math.min(this.modulation - event.movementY / 100, 1);\n        } else {\n          this.modulation = Math.max(this.modulation - event.movementY / 100, 0);\n        }\n        this.effect.setFxParams({ fx: this.effect, typeId: this.typeId, mod: this.modulation })\n\n        // console.log(this.modulation);\n      }\n    }\n  },\n}\n</script>\n\n<style scoped>\n.cell {\n  position: relative;\n  height: 85%;\n  background-color: transparent;\n  display: flex;\n  margin: 10%;\n  align-items: center;\n  justify-content: center;\n}\n\n.icon {\n  display: flex;\n  aspect-ratio: 1/1;\n  position: absolute;\n  z-index: 2;\n  background-color: transparent;\n}\n\n.icon div {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 1.5vw;\n  height: 100%;\n  aspect-ratio: 1/1;\n  background-color: transparent;\n}\n\n.icon img {\n  width: 1.5vw;\n  aspect-ratio: 1/1;\n  opacity: 80%;\n  -webkit-user-drag: none;\n}\n\n.glow {\n  border-radius: 5%;\n  flex: 1;\n  height: 100%;\n  width: 100%;\n  position: absolute;\n  z-index: 1;\n  background-color: red;\n}\n\n.glow div {\n  height: 100%;\n  width: 100%;\n  opacity: 100%;\n  color: black;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 2vw;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}