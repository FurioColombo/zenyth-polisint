{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport { nextTick } from \"vue\";\nconst qualFactor = 50;\nconst sinValsBuffer = new Array(qualFactor).fill(0);\nconst triValsBuffer = new Array(qualFactor).fill(0);\nconst sqValsBuffer = new Array(qualFactor).fill(0);\nconst sawValsBuffer = new Array(qualFactor).fill(0);\n\n//todo: rmv real audio\n// todo: remap dept in -0.5 + 0.5 range\n// todo: start only when needs to be visualized\n\nexport default {\n  components: {},\n  props: [\"freq\", \"depth\", \"wave\"],\n  data() {\n    return {\n      timing: 10,\n      //freq: this.freq,\n      //depth: this.depth,\n      intervalId: \"\",\n      waveform: this.wave\n    };\n  },\n  mounted() {\n    //console.log(\"mounted LfoVisual\")\n    this.timing = 1000 / (qualFactor * this.$props.freq);\n    for (let i = 0; i < qualFactor; i++) {\n      sinValsBuffer[i] = Math.sin(Math.PI * 2 / qualFactor * i) * this.$props.depth;\n      triValsBuffer[i] = this.$props.depth - 2 * Math.abs(2 * (i - qualFactor / 2) / qualFactor) * this.$props.depth;\n      i >= qualFactor / 2 ? sqValsBuffer[i] = this.$props.depth : sqValsBuffer[i] = -this.$props.depth;\n      sawValsBuffer[i] = this.depth * (2 * i / qualFactor - 1);\n    }\n    switch (this.waveform) {\n      case 'sine':\n        this.oscilloscopeData = sinValsBuffer;\n        break;\n      case 'triangle':\n        this.oscilloscopeData = triValsBuffer;\n        break;\n      case 'square':\n        this.oscilloscopeData = sqValsBuffer;\n        break;\n      case 'sawtooth':\n        this.oscilloscopeData = sawValsBuffer;\n        break;\n      default:\n        console.log(\"ERROR - waveform not recognised\");\n    }\n\n    // --------- GRAPHICS INIT --------\n    // use the ref to get the canvas element\n    this.canvas = this.$refs.canvas;\n\n    // set the canvas width and height to 100%\n    this.canvas.width = 4 * this.canvas.offsetWidth;\n    this.canvas.height = 4 * this.canvas.offsetHeight;\n    // get the canvas context\n    this.ctx = this.canvas.getContext(\"2d\");\n  },\n  methods: {\n    updateParams({\n      freq = this.$props.freq,\n      depth = this.$props.depth,\n      waveform = this.waveform\n    }) {\n      //this.$props.freq = freq;\n      //this.$props.depth = depth;\n      this.waveform = waveform;\n      //console.log(\"this.wave: \" + waveform);\n\n      this.timing = 1000 / (qualFactor * this.$props.freq);\n      switch (this.waveform) {\n        case 'sine':\n          this.oscilloscopeData = sinValsBuffer;\n          break;\n        case 'triangle':\n          this.oscilloscopeData = triValsBuffer;\n          break;\n        case 'square':\n          this.oscilloscopeData = sqValsBuffer;\n          break;\n        case 'sawtooth':\n          this.oscilloscopeData = sawValsBuffer;\n          break;\n        default:\n          console.log(\"ERROR - waveform not recognised\");\n      }\n      if (this.intervalId) {\n        clearInterval(this.intervalId);\n      }\n      this.stopOscilloscope();\n      //console.log(\"end - this.wave: \" + waveform)\n\n      nextTick(() => {\n        this.startOscilloscope();\n      });\n    },\n    startOscilloscope() {\n      this.canvas.width = 4 * this.canvas.offsetWidth;\n      this.canvas.height = 4 * this.canvas.offsetHeight;\n      console.log(\"start - this.waveform: \" + this.waveform);\n\n      // console.log(\"this.timing: \" + this.timing)\n      // console.log(\"avviando oscilloscope con timer \" + this.timing)\n      this.intervalId = setInterval(() => {\n        let t = this.oscilloscopeData.shift();\n        this.oscilloscopeData.push(t);\n        this.draw(this.oscilloscopeData);\n      }, this.timing);\n      //console.log(\"this.timing:  \" + this.intervalId);\n    },\n\n    stopOscilloscope() {\n      if (this.intervalId) {\n        clearInterval(this.intervalId);\n      }\n    },\n    draw(data) {\n      // clear the canvas\n      //console.log(\"drawing\")\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      let x, y, y_next;\n\n      // draw the data on the canvas\n      // set the line color\n      this.ctx.strokeStyle = \"black\";\n      // set the line width\n      this.ctx.lineWidth = 2;\n      this.ctx.beginPath();\n      y_next = this.canvas.height / 2 * (1 - data[0]).toFixed(3);\n      // loop through the data and plot it on the canvas\n      for (let i = 1; i < data.length; i++) {\n        y = y_next;\n        // calculate the x and y position of the point\n        x = i * (this.canvas.width / data.length).toFixed(3);\n        y_next = this.canvas.height / 2 * (1 - data[i]).toFixed(3);\n        // move to the x and y position\n        this.ctx.moveTo(x, y);\n        // draw a line to the next point\n        this.ctx.lineTo(x + this.canvas.width / data.length, y_next);\n        // console.log(x, y)\n      }\n      // draw the line\n      this.ctx.stroke();\n      this.ctx.moveTo(0, 0);\n    },\n    beforeDestroy() {\n      if (this.oscilloscope) {\n        this.oscilloscope.disconnect();\n        this.oscilloscope.dispose();\n      }\n    }\n  },\n  computed: {\n    oscilloscopeCanvas() {\n      return {\n        background: this.colors.purple.glow\n      };\n    }\n  }\n};","map":{"version":3,"mappings":"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","names":["nextTick","qualFactor","sinValsBuffer","Array","fill","triValsBuffer","sqValsBuffer","sawValsBuffer","components","props","data","timing","intervalId","waveform","wave","mounted","$props","freq","i","Math","sin","PI","depth","abs","oscilloscopeData","console","log","canvas","$refs","width","offsetWidth","height","offsetHeight","ctx","getContext","methods","updateParams","clearInterval","stopOscilloscope","startOscilloscope","setInterval","t","shift","push","draw","clearRect","x","y","y_next","strokeStyle","lineWidth","beginPath","toFixed","length","moveTo","lineTo","stroke","beforeDestroy","oscilloscope","disconnect","dispose","computed","oscilloscopeCanvas","background","colors","purple","glow"],"sourceRoot":"","sources":["/Users/guglielmofratticioli/Documents/POLIMI/FurioColombo.github.io/src/views/Synth/Modulators/LfoVisualizer.vue"],"sourcesContent":["<template>\n  <div class=\"lfoOscilloscope\">\n    <canvas ref=\"canvas\" class=\"lfoOscilloscopeCanvas\" :style=\"this.oscilloscopeCanvas\"></canvas>\n  </div>\n</template>\n\n<script>\nimport {nextTick} from \"vue\";\n\nconst qualFactor = 50\nconst sinValsBuffer = new Array(qualFactor).fill(0);\nconst triValsBuffer = new Array(qualFactor).fill(0);\nconst sqValsBuffer = new Array(qualFactor).fill(0);\nconst sawValsBuffer = new Array(qualFactor).fill(0);\n\n//todo: rmv real audio\n// todo: remap dept in -0.5 + 0.5 range\n// todo: start only when needs to be visualized\n\nexport default {\n  components: {},\n  props: [\"freq\", \"depth\", \"wave\"],\n  data() {\n    return {\n      timing: 10,\n      //freq: this.freq,\n      //depth: this.depth,\n      intervalId: \"\",\n      waveform: this.wave\n    }\n  },\n\n  mounted() {\n    //console.log(\"mounted LfoVisual\")\n    this.timing = 1000 / (qualFactor * this.$props.freq);\n    for (let i = 0; i < qualFactor; i++) {\n      sinValsBuffer[i] = Math.sin(Math.PI*2/qualFactor * i) * this.$props.depth;\n      triValsBuffer[i] = this.$props.depth - 2*Math.abs(2*(i - qualFactor/2)/qualFactor) * this.$props.depth\n      i >= qualFactor/2? sqValsBuffer[i] = this.$props.depth : sqValsBuffer[i] = - this.$props.depth\n      sawValsBuffer[i] = this.depth * (2*i/qualFactor -1)\n    }\n\n    switch (this.waveform) {\n      case 'sine':\n        this.oscilloscopeData = sinValsBuffer\n        break;\n      case 'triangle':\n        this.oscilloscopeData = triValsBuffer\n        break;\n      case 'square':\n        this.oscilloscopeData = sqValsBuffer;\n        break;\n      case 'sawtooth':\n        this.oscilloscopeData = sawValsBuffer;\n        break;\n      default:\n        console.log(\"ERROR - waveform not recognised\")\n    }\n\n    // --------- GRAPHICS INIT --------\n    // use the ref to get the canvas element\n    this.canvas = this.$refs.canvas;\n\n    // set the canvas width and height to 100%\n    this.canvas.width = 4*this.canvas.offsetWidth;\n    this.canvas.height = 4*this.canvas.offsetHeight;\n    // get the canvas context\n    this.ctx = this.canvas.getContext(\"2d\");\n  },\n\n  methods: {\n    updateParams({ freq = this.$props.freq, depth = this.$props.depth, waveform = this.waveform }) {\n      //this.$props.freq = freq;\n      //this.$props.depth = depth;\n      this.waveform = waveform;\n      //console.log(\"this.wave: \" + waveform);\n\n      this.timing = 1000 / (qualFactor * this.$props.freq);\n      switch (this.waveform) {\n        case 'sine':\n          this.oscilloscopeData = sinValsBuffer\n          break;\n        case 'triangle':\n          this.oscilloscopeData = triValsBuffer\n          break;\n        case 'square':\n          this.oscilloscopeData = sqValsBuffer;\n          break;\n        case 'sawtooth':\n          this.oscilloscopeData = sawValsBuffer;\n          break;\n        default:\n          console.log(\"ERROR - waveform not recognised\")\n      }\n\n      if(this.intervalId){ clearInterval(this.intervalId) }\n      this.stopOscilloscope();\n      //console.log(\"end - this.wave: \" + waveform)\n\n      nextTick(() => {\n        this.startOscilloscope()\n      })\n    },\n\n    startOscilloscope() {\n      this.canvas.width = 4*this.canvas.offsetWidth;\n      this.canvas.height = 4*this.canvas.offsetHeight;\n      console.log(\"start - this.waveform: \" + this.waveform)\n\n     // console.log(\"this.timing: \" + this.timing)\n     // console.log(\"avviando oscilloscope con timer \" + this.timing)\n      this.intervalId = setInterval(() => {\n        let t = this.oscilloscopeData.shift();\n        this.oscilloscopeData.push(t);\n        this.draw(this.oscilloscopeData);\n      }, this.timing);\n      //console.log(\"this.timing:  \" + this.intervalId);\n    },\n\n    stopOscilloscope(){\n      if(this.intervalId){ clearInterval(this.intervalId) }\n    },\n\n    draw(data) {\n      // clear the canvas\n      //console.log(\"drawing\")\n      this.ctx.clearRect(0, 0, this.canvas.width, this.canvas.height);\n      let x, y, y_next;\n\n      // draw the data on the canvas\n      // set the line color\n      this.ctx.strokeStyle = \"black\";\n      // set the line width\n      this.ctx.lineWidth = 2;\n      this.ctx.beginPath();\n\n      y_next = (this.canvas.height / 2) * (1 - data[0]).toFixed(3);\n      // loop through the data and plot it on the canvas\n      for (let i = 1; i < data.length; i++) {\n        y = y_next;\n        // calculate the x and y position of the point\n        x = i * (this.canvas.width / data.length).toFixed(3);\n        y_next = (this.canvas.height / 2) * (1 - data[i]).toFixed(3);\n        // move to the x and y position\n        this.ctx.moveTo(x, y);\n        // draw a line to the next point\n        this.ctx.lineTo(x + this.canvas.width / data.length, y_next );\n        // console.log(x, y)\n      }\n      // draw the line\n      this.ctx.stroke();\n      this.ctx.moveTo(0, 0);\n    },\n\n    beforeDestroy() {\n      if (this.oscilloscope) {\n        this.oscilloscope.disconnect();\n        this.oscilloscope.dispose();\n      }\n    },\n  }, \n  computed: {\n    oscilloscopeCanvas(){\n      return {\n        background: this.colors.purple.glow\n      } \n    }\n  }\n}\n</script>\n\n<style>\n.lfoOscilloscope {\n  margin: 0.4vw;\n  margin-right: 0.1vw;;\n  height: 90%;\n  width: 90%;\n  border: 0;\n  padding: 0;\n  box-sizing: border-box;\n  position: relative;\n}\n\n.lfoOscilloscopeCanvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 100%;\n  height: 100%;\n  border-radius: 0.2vw;\n  border: 0.06vw solid #334030;\n  box-sizing: border-box;\n  margin: 0;\n  padding: 0;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}