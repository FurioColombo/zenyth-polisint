{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport * as Tone from \"tone\";\nimport SineIcon from \"vue-material-design-icons/SineWave\";\nimport SquareIcon from \"vue-material-design-icons/SquareWave\";\nimport TriangleIcon from \"vue-material-design-icons/TriangleWave\";\nimport SawtoothIcon from \"vue-material-design-icons/SawtoothWave\";\nimport { gainToDb } from \"tone\";\nimport MyPolySynth from \"./MyPolySynth.js\";\nconst wave_types = [\"sine\", \"triangle\", \"sawtooth\", \"square\"];\nconst osc_types = [\"\", \"fm\", \"am\", \"fat\"];\nexport default {\n  components: {\n    SineIcon,\n    SquareIcon,\n    TriangleIcon,\n    SawtoothIcon\n  },\n  data() {\n    return {\n      // todo: UPDATE ALL COLOR DEPENDING ON THIS:\n      color: {\n        vol: this.colors.pink,\n        mod: this.colors.azure,\n        pitch: this.colors.green\n      },\n      // waveform_btn_style: osc_background_colors[0], todo: colors?\n      osc_types: [\"std\", \"fm\", \"am\", \"fat\"],\n      volume: 0.5,\n      modulation: 1,\n      pitch: 0,\n      pan: 0,\n      attack: 0.01,\n      decay: 0.1,\n      sustain: 1,\n      release: 0.2,\n      maxPitch: 24,\n      minPitch: -24,\n      partials: \"\",\n      oscWaveIndex: 0,\n      // wave currently selected from  ['sine','triangle', ...]\n      oscTypeIndex: 0,\n      // type of osc selected from ['std', 'fm', ...];\n      waveform_btn_style: \"lightblue\",\n      wave_icon_size: 32,\n      is_modulationDown: false,\n      is_volumeDown: false,\n      is_pitchDown: false,\n      isFilterChainRouteActive: [true, false, false],\n      modulators: {\n        vol: null,\n        mod: null,\n        pitch: null\n      }\n    };\n  },\n  props: [\"id\"],\n  mounted() {\n    document.addEventListener(\"mousemove\", this.onMouseMove);\n    document.addEventListener(\"mouseup\", this.onMouseUp);\n    window.addEventListener(\"resize\", this.resizeGraphics);\n\n    // resize graphics\n    this.resizeGraphics();\n    this.gainNode = new Tone.Gain();\n    console.log(this.polyphonyVoices);\n    this.synth = new MyPolySynth(\"\", this.gainNode, this.polyphonyVoices);\n    this.synth.setParameters({\n      volume: gainToDb(1 - this.volume)\n    });\n    this.synths.list.push(this.synth);\n    //console.log(this.synths.list)\n    // we need to init connection to first filter chain\n    // in the first osc case we need to make sure we connect after the chain is created , so we handle that with events\n    // emitted from the filter chain - in all other cases we can just normally connect to the chain\n    if (this.id > 1) {\n      this.initConnections();\n    }\n    //communicate to parent that a new osc has been created (to update volEnvelope from ModHost)\n    this.$emit(\"newOsc\");\n  },\n  computed: {\n    osc_container() {\n      return {\n        background: '#f8e7e6'\n      };\n    },\n    /*------------ TYPE BUTTON ------------*/\n    type_button() {\n      return {\n        fontSize: '.5vw',\n        background: this.colors.pink.glow\n      };\n    },\n    type_text() {\n      return {\n        color: this.colors.gray.dark\n      };\n    },\n    /*--------------- OSC -----------------*/\n    volume_area() {\n      return {\n        background: this.colors.pink.dark\n      };\n    },\n    mod_area() {\n      return {\n        background: this.colors.azure.medium\n      };\n    },\n    pitch_area() {\n      return {\n        background: this.colors.green.glow\n      };\n    },\n    mod_slider() {\n      return {\n        transform: \"rotate(-\" + this.modulation * 111 + \"deg)\",\n        background: 'white',\n        opacity: '60%'\n      };\n    },\n    volume_slider() {\n      return {\n        backgroundColor: 'white',\n        opacity: '60%',\n        transform: \"rotate(\" + this.volume * 112 + \"deg)\"\n      };\n    },\n    pitch_slider() {\n      return {\n        background: this.colors.green.medium\n      };\n    },\n    pitch_hand() {\n      return {\n        transform: \"rotate(\" + this.pitch * 50 / this.maxPitch + \"deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      };\n    },\n    osc_wave() {\n      return {\n        border: '.1vw solid ' + this.colors.green.dark,\n        background: this.colors.green.glow\n      };\n    },\n    lineL() {\n      return {\n        transform: \"rotate(66deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      };\n    },\n    lineU() {\n      return {\n        transform: \"rotate(-66deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      };\n    },\n    lineR() {\n      return {\n        transform: \"rotate(180deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      };\n    },\n    /*------------ CHAIN BUTTONS ------------*/\n    chain_buttons() {\n      return {\n        background: this.colors.pink.glow\n      };\n    },\n    button_1() {\n      let color = '';\n      if (this.isFilterChainRouteActive[0]) color = this.colors.purple.light;else {\n        color = this.colors.pink.glow;\n      }\n      return {\n        background: color,\n        border: '.1vw solid ' + this.colors.gray.dark\n      };\n    },\n    button_2() {\n      let color = '';\n      if (this.isFilterChainRouteActive[1]) color = this.colors.green.medium;else {\n        color = this.colors.pink.glow;\n      }\n      return {\n        background: color,\n        border: '.1vw solid ' + this.colors.gray.dark\n      };\n    },\n    button_3() {\n      let color = '';\n      if (this.isFilterChainRouteActive[2]) color = this.colors.pink.light;else {\n        color = this.colors.pink.glow;\n      }\n      return {\n        background: color,\n        border: '.1vw solid ' + this.colors.gray.dark\n      };\n    }\n  },\n  methods: {\n    //--------DRAG AND DROP METHODS--------\n    handleDrop(event, target) {\n      if (this.modulators[target] === null) {\n        let data = JSON.parse(event.dataTransfer.getData(\"data\"));\n        //if i'm not trying to link an evelope to volume\n        if (!(target === 'vol' && data.type === 'envelope')) {\n          //console.log(\"Dropping on \" + target)\n          //console.log(data)\n          this.modulators[target] = {\n            color: data.color,\n            id: data.id,\n            type: data.type\n          };\n          document.dispatchEvent(new CustomEvent(\"link\", {\n            detail: {\n              object: this.synth,\n              target: target,\n              color: this.color[target][\"medium\"],\n              modulator: {\n                type: this.modulators[target].type,\n                id: this.modulators[target].id\n              }\n            }\n          }));\n        }\n      }\n    },\n    handleDragEnter(target) {\n      //todo: highlight object when dragging on it\n      console.log(\"Dragging over \" + target);\n    },\n    handleDragLeave(target) {\n      console.log(\"Dragging out of \" + target);\n    },\n    unlinkMod(target) {\n      //todo: CALL BACK ENVELOPS TO UNLINK\n      document.dispatchEvent(new CustomEvent(\"unLink\", {\n        detail: {\n          object: this.synth,\n          target: target,\n          modulator: {\n            type: this.modulators[target].type,\n            id: this.modulators[target].id\n          }\n        }\n      }));\n\n      //re-hide link dot\n      this.modulators[target] = null;\n    },\n    //--------DRAG AND DROP STYLING--------\n    computedModulation(target) {\n      switch (target) {\n        case \"vol\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\",\n              right: \"0%\"\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\"\n            };\n          }\n        case \"mod\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\"\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\"\n            };\n          }\n        case \"pitch\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\",\n              left: \"0%\",\n              bottom: \"0%\"\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\"\n            };\n          }\n      }\n    },\n    computedModText(target) {\n      if (this.modulators[target]) {\n        return this.modulators[target].id;\n      } else return \"\";\n    },\n    //-----------------\n    dispose() {\n      //unlink linked modulators\n      for (let key in this.modulators) {\n        if (this.modulators[key]) this.unlinkMod(key);\n      }\n      this.$emit(\"disposed\", this.id);\n      this.synth.disconnectDispose();\n      this.synths.list.splice(this.synths.list.indexOf(this.synth), 1);\n\n      //console.log(\"Synth to remove is at index: \" + this.synths.list.indexOf(this.synth))\n      //console.log(\"list of synths remaining:\")\n      //console.log(this.synths.list)\n    },\n\n    initConnections() {\n      this.gainNode.connect(this.filterChains[0][0].getToneFilter());\n    },\n    // ----------- GRAPHIC HELPERS -----------\n    resizeGraphics() {\n      let width = document.body.clientWidth;\n      if (width >= 500) {\n        this.wave_icon_size = 32 * width / 1500;\n      } else {\n        this.wave_icon_size = 0;\n      }\n    },\n    // ---------- USER EVENTS ---------------\n    // Audio routing changed clicking the dots that represent the filter chains\n    onChainclick(id) {\n      //console.log(\"chain click - id: \" + id);\n      try {\n        if (this.isFilterChainRouteActive[id]) {\n          console.log(\"disconnect from: \" + this.filterChains[id][0] + \" \" + id);\n          this.gainNode.disconnect(this.filterChains[id][0].getToneFilter());\n        } else {\n          console.log(\"connect to: \" + this.filterChains[id][0] + \" \" + id);\n          this.gainNode.connect(this.filterChains[id][0].getToneFilter());\n        }\n      } catch (e) {\n        console.log(\"error: \" + e + \"\\nCHAIN CONNECTION TO OSC UNSUCCESSFUL. Can't connect to \" + this.filterChains[id][0]);\n      }\n      this.isFilterChainRouteActive[id] = !this.isFilterChainRouteActive[id];\n    },\n    onMouseMove(event) {\n      if (this.is_volumeDown) {\n        // RIGHT FADER - volume\n        if (event.movementY < 0) {\n          // Mouse is moving up\n          this.volume = Math.max(this.volume + event.movementY / 100, 0);\n        } else {\n          // Mouse is moving down\n          this.volume = Math.min(this.volume + event.movementY / 100, 1);\n        }\n        // -------------- modify here synth audio ----------------\n        // this.synth.volume.value = gainToDb(1 - this.volume);\n        this.synth.setParameters({\n          volume: gainToDb(1 - this.volume)\n        });\n        //console.log(\"synth volume: \" + this.volume.toFixed(2) + \" dB\");\n      } else if (this.is_modulationDown) {\n        // LEFT FADER - modulation\n        if (event.movementY < 0) {\n          // Mouse is moving down\n          this.modulation = Math.max(this.modulation + event.movementY / 100, 0);\n        } else {\n          // Mouse is moving up\n          this.modulation = Math.min(this.modulation + event.movementY / 100, 1);\n        }\n        // -------------- modify here synth audio ----------------\n        // (1- this.modulation) needed because the graphics return a value of 1 for the minimum and 0 for the max\n        this.synth.setParameters({\n          modulation: 1 - this.modulation\n        });\n        //console.log(\"modulation: \" + (1 -  this.modulation.toFixed(2)));\n      } else if (this.is_pitchDown) {\n        // BOTTOM FADER - pitch shift\n        if (event.movementX < 0) {\n          // Mouse is moving right\n          this.pitch = Math.min(this.pitch - Math.floor(event.movementX), this.maxPitch);\n        } else if (event.movementX > 0) {\n          // Mouse is moving left\n          this.pitch = Math.max(this.pitch - Math.floor(event.movementX), this.minPitch);\n        }\n        // ----------- modify here synth audio -------------\n        // todo: pitch max a dx e min a sx - meglio il contrario, secondo me - segue possibile ma brutto fix\n        // console.log(\"pitch shift: \" + this.pitch * -1)\n        // this.synth.set({detune: this.pitch * -100});\n        //console.log(\"pitch shift: \" + this.pitch);\n        this.synth.setParameters({\n          transpose: this.pitch\n        });\n        // -------------------------------------------------\n      }\n    },\n\n    onMouseUp(event) {\n      if (this.is_modulationDown) this.is_modulationDown = false;\n      if (this.is_volumeDown) this.is_volumeDown = false;\n      if (this.is_pitchDown) this.is_pitchDown = false;\n    },\n    modulationDown(event) {\n      if (!this.is_modulationDown) this.is_modulationDown = true;\n    },\n    volumeDown(event) {\n      if (!this.is_volumeDown) this.is_volumeDown = true;\n    },\n    pitchDown(event) {\n      if (!this.is_pitchDown) this.is_pitchDown = true;\n    },\n    // ----------- AUDIO -----------\n    // Update osc waveform\n    nextOscType() {\n      // go circularly on along the list osc_types list\n      this.oscTypeIndex++;\n      if (this.oscTypeIndex >= osc_types.length) this.oscTypeIndex = 0;\n      this.synth.setParameters({\n        type: osc_types[this.oscTypeIndex]\n      });\n\n      //console.log(\"osc type: \" + osc_types[this.oscTypeIndex]);\n    },\n\n    nextWaveform() {\n      // update selected wavetype changing the current index\n      this.oscWaveIndex++;\n      if (this.oscWaveIndex >= wave_types.length) this.oscWaveIndex = 0;\n\n      //console.log(wave_types[this.oscWaveIndex])\n      // set new waveform\n      this.synth.setParameters({\n        waveform: wave_types[this.oscWaveIndex]\n      });\n    },\n    // set routing\n    connect(route) {\n      this.synth.connect(route);\n    }\n  },\n  unmounted() {\n    // remove event listeners\n    window.removeEventListener(\"resize\", this.resizeGraphics);\n    document.removeEventListener(\"mousemove\", this.onMouseMove);\n    document.removeEventListener(\"mouseup\", this.onMouseUp);\n  }\n};","map":{"version":3,"mappings":"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","names":["Tone","SineIcon","SquareIcon","TriangleIcon","SawtoothIcon","gainToDb","MyPolySynth","wave_types","osc_types","components","data","color","vol","colors","pink","mod","azure","pitch","green","volume","modulation","pan","attack","decay","sustain","release","maxPitch","minPitch","partials","oscWaveIndex","oscTypeIndex","waveform_btn_style","wave_icon_size","is_modulationDown","is_volumeDown","is_pitchDown","isFilterChainRouteActive","modulators","props","mounted","document","addEventListener","onMouseMove","onMouseUp","window","resizeGraphics","gainNode","Gain","console","log","polyphonyVoices","synth","setParameters","synths","list","push","id","initConnections","$emit","computed","osc_container","background","type_button","fontSize","glow","type_text","gray","dark","volume_area","mod_area","medium","pitch_area","mod_slider","transform","opacity","volume_slider","backgroundColor","pitch_slider","pitch_hand","borderLeft","osc_wave","border","lineL","lineU","lineR","chain_buttons","button_1","purple","light","button_2","button_3","methods","handleDrop","event","target","JSON","parse","dataTransfer","getData","type","dispatchEvent","CustomEvent","detail","object","modulator","handleDragEnter","handleDragLeave","unlinkMod","computedModulation","width","height","borderRadius","position","right","display","left","bottom","computedModText","dispose","key","disconnectDispose","splice","indexOf","connect","filterChains","getToneFilter","body","clientWidth","onChainclick","disconnect","e","movementY","Math","max","min","movementX","floor","transpose","modulationDown","volumeDown","pitchDown","nextOscType","length","nextWaveform","waveform","route","unmounted","removeEventListener"],"sourceRoot":"","sources":["/Users/guglielmofratticioli/Documents/POLIMI/FurioColombo.github.io/src/views/Synth/Oscillators/Osc.vue"],"sourcesContent":["<template>\n  <!-- PLEASE DON'T GO CRAZY TRYING UNDERSTAND THIS DIVs LAYER STACKS XD, Look into OSC MIDDLE-->\n  <!-- IN \"osc_middle\" there are the movable circle slider crowns : : 'mod_slider' / 'volume_slider' -->\n  <div class=\"main_container\" @click.shift=\"dispose\">\n    <div class=\"type_button\" @click=\"nextOscType\" :style=\"this.type_button\">\n      <div class=\"innertext\" :style=\"this.type_text\">{{\n        osc_types[true] === \"\" ? 'std' : osc_types[this.oscTypeIndex]\n      }}\n      </div>\n    </div>\n    <!-- DO NOT TOUCH EVER AGAIN HTML STRUCTURE / CSS !!!!!!!!!!!!-->\n    <div class=\"osc_container\" :style=\"osc_container\">\n      <div class=\"osc\">\n        <div class=\"osc_back\">\n          <div class=\"mod_area\" :style=\"this.mod_area\"></div>\n          <div class=\"volume_area\" :style=\"this.volume_area\"></div>\n          <div class=\"pitch_slider\" :style=\"this.pitch_slider\"></div>\n        </div>\n        <div class=\"osc_middle\">\n\n          <div class=\"mod_slider\" ref=\"modulation\" :style=\"this.mod_slider\"></div>\n          <div class=\"volume_slider\" ref=\"volume\" :style=\"this.volume_slider\"></div>\n        </div>\n        <div class=\"osc_front\">\n          <div class=\"pitch_area\" :style=\"this.pitch_area\"></div>\n          <div class=\"pitch_hand\" ref=\"pitch\" :style=\"this.pitch_hand\"></div>\n          <div class=\"lineL\" :style=\"this.lineL\"></div>\n          <div class=\"lineU\" :style=\"this.lineU\"></div>\n          <div class=\"lineR\" :style=\"this.lineR\"></div>\n        </div>\n        <div class=\"draggable left\" @dragenter=\"handleDragEnter('mod')\" @dragleave=\"handleDragLeave('mod')\"\n          @dragenter.prevent @dragover.prevent @drop=\"handleDrop($event, 'mod')\" @mousedown=\"modulationDown\">\n          <div class=\"modDot\" :style=\"computedModulation('mod')\" @click.shift.stop=\"unlinkMod('mod')\"\n            v-text=\"computedModText('mod')\"></div>\n        </div>\n        <div class=\"draggable right\" @dragenter=\"handleDragEnter('vol')\" @dragleave=\"handleDragLeave('vol')\"\n          @dragenter.prevent @dragover.prevent @drop=\"handleDrop($event, 'vol')\" @mousedown=\"volumeDown\">\n          <div class=\"modDot\" :style=\"computedModulation('vol')\" @click.shift.stop=\"unlinkMod('vol')\"\n            v-text=\"computedModText('vol')\"></div>\n        </div>\n        <div class=\"draggable low\" @dragenter=\"handleDragEnter('pitch')\" @dragleave=\"handleDragLeave('pitch')\"\n          @dragenter.prevent @dragover.prevent @drop=\"handleDrop($event, 'pitch')\" @mousedown=\"pitchDown\">\n          <div class=\"modDot\" :style=\"computedModulation('pitch')\" @click.shift.stop=\"unlinkMod('pitch')\"\n            v-text=\"computedModText('pitch')\"></div>\n        </div>\n        <div class=\"osc_wave\" @click=\"nextWaveform\" :style=\"this.osc_wave\">\n          <img v-if=\"this.oscWaveIndex === 0\" src=\"@/icons/sine.svg\" alt=\"\" draggable=\"false\">\n          <img v-if=\"this.oscWaveIndex === 1\" src=\"@/icons/triangle.svg\" alt=\"\" draggable=\"false\">\n          <img v-if=\"this.oscWaveIndex === 2\" src=\"@/icons/saw.svg\" alt=\"\" draggable=\"false\">\n          <img v-if=\"this.oscWaveIndex === 3\" src=\"@/icons/square.svg\" alt=\"\" draggable=\"false\">\n        </div>\n      </div>\n    </div>\n    <div class=\"chain_buttons\" :style=\"chain_buttons\">\n      <div></div>\n      <div class=\"button_1\" :style=\"button_1\" @click=\"this.onChainclick(0)\"></div>\n      <div class=\"button_2\" :style=\"button_2\" @click=\"this.onChainclick(1)\"></div>\n      <div class=\"button_3\" :style=\"button_3\" @click=\"this.onChainclick(2)\"></div>\n      <div></div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport * as Tone from \"tone\";\nimport SineIcon from \"vue-material-design-icons/SineWave\";\nimport SquareIcon from \"vue-material-design-icons/SquareWave\";\nimport TriangleIcon from \"vue-material-design-icons/TriangleWave\";\nimport SawtoothIcon from \"vue-material-design-icons/SawtoothWave\";\nimport {gainToDb} from \"tone\";\nimport MyPolySynth from \"./MyPolySynth.js\";\n\nconst wave_types = [\"sine\", \"triangle\", \"sawtooth\", \"square\"];\nconst osc_types = [\"\", \"fm\", \"am\", \"fat\"];\n\nexport default {\n  components: {\n    SineIcon,\n    SquareIcon,\n    TriangleIcon,\n    SawtoothIcon,\n  },\n\n  data() {\n    return {\n      // todo: UPDATE ALL COLOR DEPENDING ON THIS:\n      color: {\n        vol: this.colors.pink,\n        mod: this.colors.azure,\n        pitch: this.colors.green\n      },\n\n\n      // waveform_btn_style: osc_background_colors[0], todo: colors?\n      osc_types: [\"std\", \"fm\", \"am\", \"fat\"],\n      volume: 0.5,\n      modulation: 1,\n      pitch: 0,\n      pan: 0,\n      attack: 0.01,\n      decay: 0.1,\n      sustain: 1,\n      release: 0.2,\n      maxPitch: 24,\n      minPitch: -24,\n      partials: \"\",\n      oscWaveIndex: 0, // wave currently selected from  ['sine','triangle', ...]\n      oscTypeIndex: 0, // type of osc selected from ['std', 'fm', ...];\n      waveform_btn_style: \"lightblue\",\n      wave_icon_size: 32,\n      is_modulationDown: false,\n      is_volumeDown: false,\n      is_pitchDown: false,\n      isFilterChainRouteActive: [true, false, false],\n      modulators: {\n        vol: null,\n        mod: null,\n        pitch: null\n      },\n    };\n  },\n  props: [\"id\"],\n\n  mounted() {\n    document.addEventListener(\"mousemove\", this.onMouseMove);\n    document.addEventListener(\"mouseup\", this.onMouseUp);\n    window.addEventListener(\"resize\", this.resizeGraphics);\n\n    // resize graphics\n    this.resizeGraphics();\n    this.gainNode = new Tone.Gain();\n    console.log(this.polyphonyVoices)\n    this.synth = new MyPolySynth(\"\", this.gainNode, this.polyphonyVoices);\n    this.synth.setParameters({ volume: gainToDb(1 - this.volume) });\n\n    this.synths.list.push(this.synth)\n    //console.log(this.synths.list)\n    // we need to init connection to first filter chain\n    // in the first osc case we need to make sure we connect after the chain is created , so we handle that with events\n    // emitted from the filter chain - in all other cases we can just normally connect to the chain\n    if (this.id > 1) {\n      this.initConnections()\n    }\n    //communicate to parent that a new osc has been created (to update volEnvelope from ModHost)\n    this.$emit(\"newOsc\")\n\n  },\n\n  computed: {\n\n    osc_container() {\n      return {\n        background: '#f8e7e6'\n      }\n    },\n    /*------------ TYPE BUTTON ------------*/\n    type_button() {\n      return {\n        fontSize: '.5vw',\n        background: this.colors.pink.glow\n      }\n    },\n    type_text() {\n      return {\n        color: this.colors.gray.dark\n      }\n    },\n    /*--------------- OSC -----------------*/\n    volume_area() {\n      return {\n        background: this.colors.pink.dark\n      }\n    },\n    mod_area() {\n      return {\n        background: this.colors.azure.medium\n      }\n    },\n    pitch_area() {\n      return {\n        background: this.colors.green.glow\n      }\n    },\n    mod_slider() {\n      return {\n        transform: \"rotate(-\" + this.modulation * 111 + \"deg)\",\n        background: 'white',\n        opacity: '60%'\n      }\n    },\n    volume_slider() {\n      return {\n        backgroundColor: 'white',\n        opacity: '60%',\n        transform: \"rotate(\" + this.volume * 112 + \"deg)\",\n      }\n    },\n    pitch_slider() {\n      return {\n        background: this.colors.green.medium\n      }\n    },\n    pitch_hand() {\n      return {\n        transform: \"rotate(\" + (this.pitch * 50) / this.maxPitch + \"deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      }\n    },\n    osc_wave() {\n      return {\n        border: '.1vw solid ' + this.colors.green.dark,\n        background: this.colors.green.glow\n      }\n    },\n    lineL() {\n      return {\n        transform: \"rotate(66deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      }\n    },\n    lineU() {\n      return {\n        transform: \"rotate(-66deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      }\n    },\n    lineR() {\n      return {\n        transform: \"rotate(180deg)\",\n        borderLeft: \".1vw solid \" + this.colors.green.dark\n      }\n    },\n    /*------------ CHAIN BUTTONS ------------*/\n    chain_buttons() {\n      return {\n        background: this.colors.pink.glow\n      }\n    },\n    button_1() {\n      let color = ''\n      if (this.isFilterChainRouteActive[0])\n        color = this.colors.purple.light\n      else {\n        color = this.colors.pink.glow\n      }\n      return {\n        background: color, \n        border: '.1vw solid ' + this.colors.gray.dark \n      }\n    },\n    button_2() {\n      let color = ''\n      if (this.isFilterChainRouteActive[1])\n        color = this.colors.green.medium\n      else {\n        color = this.colors.pink.glow\n      }\n      return {\n        background: color, \n        border: '.1vw solid ' + this.colors.gray.dark \n      }\n    },\n    button_3() {\n      let color = ''\n      if (this.isFilterChainRouteActive[2])\n        color = this.colors.pink.light\n      else {\n        color = this.colors.pink.glow\n      }\n      return {\n        background: color, \n        border: '.1vw solid ' + this.colors.gray.dark \n      }\n    },\n  },\n\n  methods: {\n\n    //--------DRAG AND DROP METHODS--------\n    handleDrop(event, target) {\n      if (this.modulators[target] === null) {\n        let data = JSON.parse(event.dataTransfer.getData(\"data\"));\n        //if i'm not trying to link an evelope to volume\n        if (!(target === 'vol' && data.type === 'envelope')) {\n          //console.log(\"Dropping on \" + target)\n          //console.log(data)\n          this.modulators[target] = {color: data.color, id: data.id, type: data.type}\n          document.dispatchEvent(new CustomEvent(\"link\", {\n                detail: {\n                  object: this.synth,\n                  target: target,\n                  color: this.color[target][\"medium\"],\n                  modulator: {type: this.modulators[target].type, id: this.modulators[target].id}\n                }\n              }\n          ))\n        }\n      }\n\n    },\n    handleDragEnter(target) {\n      //todo: highlight object when dragging on it\n      console.log(\"Dragging over \" + target)\n    },\n    handleDragLeave(target) {\n      console.log(\"Dragging out of \" + target)\n    },\n    unlinkMod(target) {\n      //todo: CALL BACK ENVELOPS TO UNLINK\n      document.dispatchEvent(new CustomEvent(\"unLink\", {\n            detail: {\n              object: this.synth,\n              target: target,\n              modulator: {type: this.modulators[target].type, id: this.modulators[target].id}\n            }\n          }\n      ))\n\n      //re-hide link dot\n      this.modulators[target] = null;\n\n    },\n    //--------DRAG AND DROP STYLING--------\n    computedModulation(target) {\n      switch (target) {\n        case \"vol\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\",\n              right: \"0%\",\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\",\n            }\n          }\n\n        case \"mod\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\",\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\",\n            }\n          }\n        case \"pitch\":\n          if (this.modulators[target]) {\n            return {\n              width: \"1vw\",\n              height: \"1vw\",\n              borderRadius: \"50%\",\n              backgroundColor: this.modulators[target].color,\n              position: \"absolute\",\n              left: \"0%\",\n              bottom: \"0%\"\n            };\n          } else {\n            return {\n              display: \"none\",\n              width: \"0%\",\n              height: \"0%\",\n            }\n          }\n      }\n    },\n    computedModText(target) {\n      if (this.modulators[target]) {\n        return this.modulators[target].id\n      } else return \"\";\n    },\n\n\n\n    //-----------------\n    dispose() {\n      //unlink linked modulators\n      for (let key in this.modulators) {\n        if (this.modulators[key])\n          this.unlinkMod(key)\n      }\n\n      this.$emit(\"disposed\", this.id)\n      this.synth.disconnectDispose()\n      this.synths.list.splice(this.synths.list.indexOf(this.synth), 1)\n\n\n      //console.log(\"Synth to remove is at index: \" + this.synths.list.indexOf(this.synth))\n      //console.log(\"list of synths remaining:\")\n      //console.log(this.synths.list)\n    },\n    initConnections() {\n      this.gainNode.connect(this.filterChains[0][0].getToneFilter())\n    },\n\n    // ----------- GRAPHIC HELPERS -----------\n    resizeGraphics() {\n      let width = document.body.clientWidth;\n      if (width >= 500) {\n        this.wave_icon_size = (32 * width) / 1500;\n      } else {\n        this.wave_icon_size = 0;\n      }\n    },\n\n    // ---------- USER EVENTS ---------------\n    // Audio routing changed clicking the dots that represent the filter chains\n    onChainclick(id) {\n      //console.log(\"chain click - id: \" + id);\n      try {\n        if (this.isFilterChainRouteActive[id]) {\n          console.log(\n              \"disconnect from: \" +\n              this.filterChains[id][0] + \" \" + id\n          );\n          this.gainNode.disconnect(\n              this.filterChains[id][0].getToneFilter()\n          );\n        } else {\n          console.log(\n            \"connect to: \" +\n            this.filterChains[id][0] + \" \" + id\n          );\n          this.gainNode.connect(\n              this.filterChains[id][0].getToneFilter()\n          );\n        }\n      } catch (e) {\n        console.log(\n          \"error: \" + e + \"\\nCHAIN CONNECTION TO OSC UNSUCCESSFUL. Can't connect to \" + this.filterChains[id][0]\n        );\n      }\n      this.isFilterChainRouteActive[id] = !this.isFilterChainRouteActive[id];\n    },\n\n    onMouseMove(event) {\n      if (this.is_volumeDown) {\n        // RIGHT FADER - volume\n        if (event.movementY < 0) {\n          // Mouse is moving up\n          this.volume = Math.max(this.volume + event.movementY / 100, 0);\n        } else {\n          // Mouse is moving down\n          this.volume = Math.min(this.volume + event.movementY / 100, 1);\n        }\n        // -------------- modify here synth audio ----------------\n        // this.synth.volume.value = gainToDb(1 - this.volume);\n        this.synth.setParameters({ volume: gainToDb(1 - this.volume) });\n        //console.log(\"synth volume: \" + this.volume.toFixed(2) + \" dB\");\n      } else if (this.is_modulationDown) {\n        // LEFT FADER - modulation\n        if (event.movementY < 0) {\n          // Mouse is moving down\n          this.modulation = Math.max(this.modulation + event.movementY / 100, 0);\n        } else {\n          // Mouse is moving up\n          this.modulation = Math.min(this.modulation + event.movementY / 100, 1);\n        }\n        // -------------- modify here synth audio ----------------\n        // (1- this.modulation) needed because the graphics return a value of 1 for the minimum and 0 for the max\n        this.synth.setParameters({modulation: 1 - this.modulation })\n        //console.log(\"modulation: \" + (1 -  this.modulation.toFixed(2)));\n      } else if (this.is_pitchDown) {\n        // BOTTOM FADER - pitch shift\n        if (event.movementX < 0) {\n          // Mouse is moving right\n          this.pitch = Math.min(this.pitch - Math.floor(event.movementX), this.maxPitch);\n        } else if (event.movementX > 0) {\n          // Mouse is moving left\n          this.pitch = Math.max(this.pitch - Math.floor(event.movementX), this.minPitch);\n        }\n        // ----------- modify here synth audio -------------\n        // todo: pitch max a dx e min a sx - meglio il contrario, secondo me - segue possibile ma brutto fix\n        // console.log(\"pitch shift: \" + this.pitch * -1)\n        // this.synth.set({detune: this.pitch * -100});\n        //console.log(\"pitch shift: \" + this.pitch);\n        this.synth.setParameters({ transpose: this.pitch });\n        // -------------------------------------------------\n      }\n    },\n    onMouseUp(event) {\n      if (this.is_modulationDown) this.is_modulationDown = false;\n      if (this.is_volumeDown) this.is_volumeDown = false;\n      if (this.is_pitchDown) this.is_pitchDown = false;\n    },\n\n    modulationDown(event) {\n      if (!this.is_modulationDown) this.is_modulationDown = true;\n    },\n    volumeDown(event) {\n      if (!this.is_volumeDown) this.is_volumeDown = true;\n    },\n    pitchDown(event) {\n      if (!this.is_pitchDown) this.is_pitchDown = true;\n    },\n\n    // ----------- AUDIO -----------\n    // Update osc waveform\n    nextOscType() {\n      // go circularly on along the list osc_types list\n      this.oscTypeIndex++;\n      if (this.oscTypeIndex >= osc_types.length) this.oscTypeIndex = 0;\n\n      this.synth.setParameters({ type: osc_types[this.oscTypeIndex] })\n\n      //console.log(\"osc type: \" + osc_types[this.oscTypeIndex]);\n    },\n\n    nextWaveform() {\n      // update selected wavetype changing the current index\n      this.oscWaveIndex++;\n      if (this.oscWaveIndex >= wave_types.length) this.oscWaveIndex = 0;\n\n      //console.log(wave_types[this.oscWaveIndex])\n      // set new waveform\n      this.synth.setParameters({ waveform: wave_types[this.oscWaveIndex] })\n    },\n\n    // set routing\n    connect(route) {\n      this.synth.connect(route);\n    },\n  },\n\n  unmounted() {\n    // remove event listeners\n    window.removeEventListener(\"resize\", this.resizeGraphics);\n    document.removeEventListener(\"mousemove\", this.onMouseMove);\n    document.removeEventListener(\"mouseup\", this.onMouseUp);\n  },\n};\n</script>\n\n<style scoped>\n.modDot {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  font-size: 0.8vw;\n  text-align: center;\n  box-sizing: border-box;\n  border: .06vw solid black;\n}\n\n.main_container {\n  border: .1vw solid #c2847b ;\n  box-sizing: border-box;\n  height: calc(100% / 3);\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n}\n.main_container:hover {\n  border: .1vw solid #63443e;\n  box-sizing: border-box;\n  height: calc(100% / 3);\n  display: flex;\n  flex-direction: row;\n  justify-content: center;\n  align-items: center;\n}\n\n.osc_container {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  position: relative;\n  flex: 4;\n  height: 100%;\n  width: 100%;\n}\n\n/*---------- MOD TYPE BUTTON ----------*/\n.type_button {\n  border: .1vw solid #c2847b;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex: 1;\n  height: 100%;\n}\n.type_button:hover {\n  border: .1vw solid #63443e;\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  flex: 1;\n  height: 100%;\n}\n\n.type_button .innertext {\n  font-size: .8vw;\n  writing-mode: vertical-rl;\n  text-orientation: upright;\n  text-transform: uppercase;\n}\n\n/*--------------- OSC -----------------*/\n.osc {\n  width: 90%;\n  justify-content: center;\n  align-items: center;\n  display: flex;\n  position: relative;\n  aspect-ratio: 1/1;\n}\n\n.osc_back {\n  margin: auto;\n  width: 100%;\n  position: absolute;\n  aspect-ratio: 1/1;\n  clip-path: circle(50%);\n  z-index: 1;\n}\n\n.pitch_slider {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  clip-path: polygon(50% 100%, 100% 100%, 100% 72%, 50% 50%, 0% 72%, 0% 100%);\n  z-index: 27;\n}\n\n.mod_area {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  clip-path: polygon(50% 0%, 0% 0%, 0% 100%, 50% 50%);\n  z-index: 2;\n}\n\n.volume_area {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 50%);\n  z-index: 3;\n}\n\n.osc_middle {\n  margin: auto;\n  height: 95%;\n  top: 2.5%;\n  left: 2.5%;\n  position: absolute;\n  aspect-ratio: 1/1;\n  clip-path: circle(50%);\n  z-index: 25;\n}\n\n.mod_slider {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  clip-path: polygon(50% 0%, 0% 0%, 0% 100%, 50% 50%);\n  z-index: 27;\n}\n\n.volume_slider {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  clip-path: polygon(50% 0%, 100% 0%, 100% 100%, 50% 50%);\n  z-index: 26;\n}\n\n.osc_front {\n  margin: auto;\n  height: 96%;\n  top: 2%;\n  left: 2%;\n  position: absolute;\n  aspect-ratio: 1/1;\n  clip-path: circle(50%);\n  z-index: 50;\n}\n\n.pitch_area {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  clip-path: polygon(50% 100%,\n      100% 100%,\n      100% 72%,\n      50% 50%,\n      0% 72%,\n      0% 100%,\n      50% 100%);\n  z-index: 10;\n}\n\n.pitch_hand {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  height: 40%;\n  width: 100%;\n  transform-origin: 0 0;\n  z-index: 15;\n}\n.lineL {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  height: 100%;\n  width: 100%;\n  transform-origin: 0 0;\n  z-index: 15;\n}\n\n.lineU {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  height: 100%;\n  width: 100%;\n  transform-origin: 0 0;\n  z-index: 15;\n}\n.lineR {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  height: 100%;\n  width: 100%;\n  transform-origin: 0 0;\n  z-index: 15;\n}\n\n\n.osc_wave {\n  display: flex;\n  position: relative;\n  aspect-ratio: 1;\n  width: 45%;\n  border-radius: 50%;\n  left: 0;\n  top: 0;\n  z-index: 101;\n}\n\n.osc_wave img {\n  position: relative;\n  aspect-ratio: 1/1;\n  width: 100%;\n  left: 0;\n  top: 0;\n  clip-path: circle(20%);\n  z-index: 102;\n}\n\n.draggable {\n  position: absolute;\n  z-index: 75;\n}\n\n.left {\n  width: 50%;\n  height: 70%;\n  left: 0;\n  bottom: 30%;\n  background-color: transparent;\n}\n\n.right {\n  width: 50%;\n  height: 70%;\n  background-color: transparent;\n  left: 50%;\n  bottom: 30%\n}\n\n.low {\n  width: 100%;\n  height: 30%;\n  top: 70%;\n  background-color: transparent;\n}\n\n/*------------ CHAIN BUTTONS ------------*/\n.chain_buttons {\n  border: .1vw solid #c2847b;\n  flex: .5;\n  display: grid;\n  grid-template-rows: .3fr 1fr 1fr 1fr .3fr;\n  height: 100%;\n  align-items: center;\n  padding-left: 3%;\n  padding-right: 3%;\n}\n.chain_buttons:hover {\n  border: .1vw solid #63443e;\n  flex: .5;\n  display: grid;\n  grid-template-rows: .3fr 1fr 1fr 1fr .3fr;\n  height: 100%;\n  align-items: center;\n  padding-left: 3%;\n  padding-right: 3%;\n}\n\n\n.button_1,\n.button_2,\n.button_3 {\n  width: 100%;\n  aspect-ratio: 1/1;\n  border: .1vw solid black;\n  border-radius: 50%;\n}\n</style>"]},"metadata":{},"sourceType":"module","externalDependencies":[]}