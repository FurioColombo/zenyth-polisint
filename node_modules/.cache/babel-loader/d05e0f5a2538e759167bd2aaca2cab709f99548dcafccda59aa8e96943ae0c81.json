{"ast":null,"code":"import _classCallCheck from \"/Users/eliapirrello/Documents/GitHub/zenyth/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";\nimport _createClass from \"/Users/eliapirrello/Documents/GitHub/zenyth/node_modules/@babel/runtime/helpers/esm/createClass.js\";\nimport _assertThisInitialized from \"/Users/eliapirrello/Documents/GitHub/zenyth/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js\";\nimport _get from \"/Users/eliapirrello/Documents/GitHub/zenyth/node_modules/@babel/runtime/helpers/esm/get.js\";\nimport _getPrototypeOf from \"/Users/eliapirrello/Documents/GitHub/zenyth/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js\";\nimport _inherits from \"/Users/eliapirrello/Documents/GitHub/zenyth/node_modules/@babel/runtime/helpers/esm/inherits.js\";\nimport _createSuper from \"/Users/eliapirrello/Documents/GitHub/zenyth/node_modules/@babel/runtime/helpers/esm/createSuper.js\";\nimport \"core-js/modules/es.function.name.js\";\nimport \"core-js/modules/es.function.bind.js\";\nimport { Signal } from \"./Signal\";\nimport { optionsFromArguments } from \"../core/util/Defaults\";\nimport { TransportTimeClass } from \"../core/type/TransportTime\";\nimport { ToneConstantSource } from \"./ToneConstantSource\";\n/**\n * Adds the ability to synchronize the signal to the [[Transport]]\n */\nexport var SyncedSignal = /*#__PURE__*/function (_Signal) {\n  _inherits(SyncedSignal, _Signal);\n  var _super = _createSuper(SyncedSignal);\n  function SyncedSignal() {\n    var _this;\n    _classCallCheck(this, SyncedSignal);\n    _this = _super.call(this, optionsFromArguments(Signal.getDefaults(), arguments, [\"value\", \"units\"]));\n    _this.name = \"SyncedSignal\";\n    /**\n     * Don't override when something is connected to the input\n     */\n    _this.override = false;\n    var options = optionsFromArguments(Signal.getDefaults(), arguments, [\"value\", \"units\"]);\n    _this._lastVal = options.value;\n    _this._synced = _this.context.transport.scheduleRepeat(_this._onTick.bind(_assertThisInitialized(_this)), \"1i\");\n    _this._syncedCallback = _this._anchorValue.bind(_assertThisInitialized(_this));\n    _this.context.transport.on(\"start\", _this._syncedCallback);\n    _this.context.transport.on(\"pause\", _this._syncedCallback);\n    _this.context.transport.on(\"stop\", _this._syncedCallback);\n    // disconnect the constant source from the output and replace it with another one\n    _this._constantSource.disconnect();\n    _this._constantSource.stop(0);\n    // create a new one\n    _this._constantSource = _this.output = new ToneConstantSource({\n      context: _this.context,\n      offset: options.value,\n      units: options.units\n    }).start(0);\n    _this.setValueAtTime(options.value, 0);\n    return _this;\n  }\n  /**\n   * Callback which is invoked every tick.\n   */\n  _createClass(SyncedSignal, [{\n    key: \"_onTick\",\n    value: function _onTick(time) {\n      var val = _get(_getPrototypeOf(SyncedSignal.prototype), \"getValueAtTime\", this).call(this, this.context.transport.seconds);\n      // approximate ramp curves with linear ramps\n      if (this._lastVal !== val) {\n        this._lastVal = val;\n        this._constantSource.offset.setValueAtTime(val, time);\n      }\n    }\n    /**\n     * Anchor the value at the start and stop of the Transport\n     */\n  }, {\n    key: \"_anchorValue\",\n    value: function _anchorValue(time) {\n      var val = _get(_getPrototypeOf(SyncedSignal.prototype), \"getValueAtTime\", this).call(this, this.context.transport.seconds);\n      this._lastVal = val;\n      this._constantSource.offset.cancelAndHoldAtTime(time);\n      this._constantSource.offset.setValueAtTime(val, time);\n    }\n  }, {\n    key: \"getValueAtTime\",\n    value: function getValueAtTime(time) {\n      var computedTime = new TransportTimeClass(this.context, time).toSeconds();\n      return _get(_getPrototypeOf(SyncedSignal.prototype), \"getValueAtTime\", this).call(this, computedTime);\n    }\n  }, {\n    key: \"setValueAtTime\",\n    value: function setValueAtTime(value, time) {\n      var computedTime = new TransportTimeClass(this.context, time).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"setValueAtTime\", this).call(this, value, computedTime);\n      return this;\n    }\n  }, {\n    key: \"linearRampToValueAtTime\",\n    value: function linearRampToValueAtTime(value, time) {\n      var computedTime = new TransportTimeClass(this.context, time).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"linearRampToValueAtTime\", this).call(this, value, computedTime);\n      return this;\n    }\n  }, {\n    key: \"exponentialRampToValueAtTime\",\n    value: function exponentialRampToValueAtTime(value, time) {\n      var computedTime = new TransportTimeClass(this.context, time).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"exponentialRampToValueAtTime\", this).call(this, value, computedTime);\n      return this;\n    }\n  }, {\n    key: \"setTargetAtTime\",\n    value: function setTargetAtTime(value, startTime, timeConstant) {\n      var computedTime = new TransportTimeClass(this.context, startTime).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"setTargetAtTime\", this).call(this, value, computedTime, timeConstant);\n      return this;\n    }\n  }, {\n    key: \"cancelScheduledValues\",\n    value: function cancelScheduledValues(startTime) {\n      var computedTime = new TransportTimeClass(this.context, startTime).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"cancelScheduledValues\", this).call(this, computedTime);\n      return this;\n    }\n  }, {\n    key: \"setValueCurveAtTime\",\n    value: function setValueCurveAtTime(values, startTime, duration, scaling) {\n      var computedTime = new TransportTimeClass(this.context, startTime).toSeconds();\n      duration = this.toSeconds(duration);\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"setValueCurveAtTime\", this).call(this, values, computedTime, duration, scaling);\n      return this;\n    }\n  }, {\n    key: \"cancelAndHoldAtTime\",\n    value: function cancelAndHoldAtTime(time) {\n      var computedTime = new TransportTimeClass(this.context, time).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"cancelAndHoldAtTime\", this).call(this, computedTime);\n      return this;\n    }\n  }, {\n    key: \"setRampPoint\",\n    value: function setRampPoint(time) {\n      var computedTime = new TransportTimeClass(this.context, time).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"setRampPoint\", this).call(this, computedTime);\n      return this;\n    }\n  }, {\n    key: \"exponentialRampTo\",\n    value: function exponentialRampTo(value, rampTime, startTime) {\n      var computedTime = new TransportTimeClass(this.context, startTime).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"exponentialRampTo\", this).call(this, value, rampTime, computedTime);\n      return this;\n    }\n  }, {\n    key: \"linearRampTo\",\n    value: function linearRampTo(value, rampTime, startTime) {\n      var computedTime = new TransportTimeClass(this.context, startTime).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"linearRampTo\", this).call(this, value, rampTime, computedTime);\n      return this;\n    }\n  }, {\n    key: \"targetRampTo\",\n    value: function targetRampTo(value, rampTime, startTime) {\n      var computedTime = new TransportTimeClass(this.context, startTime).toSeconds();\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"targetRampTo\", this).call(this, value, rampTime, computedTime);\n      return this;\n    }\n  }, {\n    key: \"dispose\",\n    value: function dispose() {\n      _get(_getPrototypeOf(SyncedSignal.prototype), \"dispose\", this).call(this);\n      this.context.transport.clear(this._synced);\n      this.context.transport.off(\"start\", this._syncedCallback);\n      this.context.transport.off(\"pause\", this._syncedCallback);\n      this.context.transport.off(\"stop\", this._syncedCallback);\n      this._constantSource.dispose();\n      return this;\n    }\n  }]);\n  return SyncedSignal;\n}(Signal);","map":{"version":3,"mappings":"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","names":["Signal","optionsFromArguments","TransportTimeClass","ToneConstantSource","SyncedSignal","getDefaults","arguments","options","_lastVal","value","_synced","context","transport","scheduleRepeat","_onTick","bind","_syncedCallback","_anchorValue","on","_constantSource","disconnect","stop","output","offset","units","start","setValueAtTime","time","val","seconds","cancelAndHoldAtTime","computedTime","toSeconds","startTime","timeConstant","values","duration","scaling","rampTime","clear","off","dispose"],"sourceRoot":"","sources":["../../../Tone/signal/SyncedSignal.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"module","externalDependencies":[]}